<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="W5" />
    <link rel="stylesheet" type="text/css" media="screen" href="./../../../resources/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="./../../../resources/bootstrap/css/carousel.css">
    <link rel="stylesheet" type="text/css" media="screen" href="./../../../resources/stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="screen" href="./../../../resources/stylesheets/common.css">
    <link rel="stylesheet" type="text/css" media="screen" href="./../../../resources/prism/prism.css">
    <link rel="stylesheet" type="text/css" media="screen" href="./../../../resources/prism/prism-coy.css">
    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o), m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
        ga('create', 'UA-1212521-12', 'w5.io');
        ga('send', 'pageview');
    </script>
    <title>W5 : Synchronize Server</title>
</head>

<body>
    <!-- HEADER -->
    <header id="header_wrap">
        <div class="navbar-wrapper">
            <div class="navbar navbar-inverse navbar-static-top" role="navigation">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"> <span class="sr-only">Toggle navigation</span>  <span class="icon-bar"></span>  <span class="icon-bar"></span>  <span class="icon-bar"></span> 
                    </button>
                    <a class="navbar-brand" href="../../../../index.html">
                        <img src="../../../resources/images/w5_w.png" class="logo" alt="W5" />
                    </a>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <!--li class="active"><a href="#">Getting started</a></li>          <li class="divider"></li>          <li class="dropdown-header">Nav header</li-->
                        <li><a href="../../../gettingStarted/gettingStarted/doc/gettingStarted.html">Getting started</a>
                        </li>
                        <li><a href="../../../samples/basic/doc/createW5Grid.html">Samples</a>
                        </li>
                        <li><a href="#" onclick="openAlert(this);">API Docs</a>
                        </li>
                        <!--li class="dropdown"-->
                        <li> <a href="#" onclick="openAlert(this);">Support</a> 
                            <!--a href="" class="dropdown-toggle" data-toggle="dropdown">Support<b class="caret"></b></a>            <ul class="dropdown-menu">              <li><a href="">Forum</a></li>              <li><a href="">Purchase Options</a></li>            </ul-->
                        </li>
                        <!--li class="dropdown"-->
                        <li> <a href="#" onclick="openAlert(this);">About</a> 
                            <!--a href="" class="dropdown-toggle" data-toggle="dropdown">About<b class="caret"></b></a>            <ul class="dropdown-menu">              <li><a href="">Company</a></li>              <li><a href="">Contact us</a></li>            </ul-->
                        </li>
                    </ul>
                    <div class="language">
                        <label for="select-langue">Language</label>
                        <select id="select-langue" class="ml10">
                            <option value="en" selected="true">English</option>
                            <option value="ko">Korean</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="visual">
            <h1>Samples</h1> 
            <p>W5 Grid가 얼마나 강력한지 Sample을 통해서 알아봅니다.</p>
        </div>
    </header>
    <!-- MAIN CONTENT -->
    <div id="main_content" class="inner row content">
        <aside class="lnb">
            <nav id="lnbList">
                <h1>Samples</h1> 
                <!--ul>                <li><a href=""></a></li>                </ul-->
            </nav>
        </aside>
        <article class="contents">
            <section>
                <h1 id="synchronize-server">Synchronize Server</h1>
                <p>Backbone.Collection 및 Model 메소드와 W5 메소드를 이용하여 서버와 데이타 동기화를 한다.
                    <br><a href="http://backbonejs.org/#Sync">Backbone 에서 제공하는 sync 및 fetch</a> 를 참조하기 바란다.
                    <br>관련 샘플은 <a href="https://github.com/inswave/w5grid-rest-node">w5grid-rest-node</a> 에서 확인하기 바란다.</p>
                <h2 id="fetch">Fetch</h2>
                <p>통신하기 위한 URL 을 Backbone.Collection extend 시점이나 객체의 property 로 지정한다.</p>
                <pre><code class="language-javascript">  // Collection 정의 시점에 통신할 url 을 지정합니다.
  var List = Backbone.Collection.extend( { url: '/people' } ),
      dataCols = new List(),
      grid1 = new w5.Grid({
        ....
        collection : dataCols
      });

  // Collection 객체 생성 후 url property 에 필요한 위치를 지정한다.
  var collection = Backbone.Collection.extend();
  dataCols = new collection();
  dataCols.url = '/people';
</code></pre>
                <p>Backbone.Collection 및 Model 의 fetch 메소드를 호출하여 서버로부터 데이터를 가져옵니다.</p>
                <pre><code class="language-javascript">  // Backbone.Collection 의 fetch 메소드릍 통해 그리드 데이타를 얻어온다.
  // reset 옵션을 통해 얻어온 데이타로 그리드 전체를 다시 그린다.
  // 동기화 성공/실패에 따른 handler 를 지정하여 프로세스 후처리를 한다.
  dataCols.fetch( { reset: true,
    success: function ( collection, response, options ) {
      // 동기화 callback 처리
    },
    error: function ( collection, response, options ) {
      // 에러 처리
    }
  });

  // Backbone.Collection 의 특정 Model 만 fetch 를 수행한다.
  dataCols.at(0).fetch({
    success: function ( model, response, options ) {
      ....
    },
    error: function ( model, response, options ) {
      ....
    }
  });
</code></pre>
                <h2 id="save">Save</h2>
                <p>set 메소드 실행시 save 옵션을 지정하면 데이타와 View 를 수정함과 동시에 서버와 동기화를 한다.
                    <br>set 메소드는 update 를 수행함으로 HTTP <code class="language-javascript">PUT</code> 메소드로 서버와 통신한다.
                    <br>HTTP 메소드는 <a href="http://backbonejs.org/#Sync">Backbone.sync</a>를 참조한다.
                    <br>Model.urlRoot 메소드를 통해 별도의 url 을 지정하지 않은 경우, [collection.url]/[id] 형태로 URL 이 자동 생성된다.
                    <br>URL은 <a href="http://backbonejs.org/#Model-url">Model.url 및 urlRootmodel</a>를 참조한다.</p>
                <pre><code class="language-javascript">  // 첫 번째 Row 의 phone1 과 phone2 컬럼을 수정함과 동시에 save 옵션을 통해 서버와 동기화를 수행한다.  
  var data = { phone1: '111-111-1111', phone2: '222-222-2222' };  
  grid1.row(0).set( 'data', data, { save: true, saved: true } );
</code></pre>
                <p>saved 옵션은 서버 통신 성공 후 response data 의 parse 단계를 생략하고 이미 Backbone.Model 에 set(update)된 데이타를 이용한다.
                    <br>이 옵션은 response data 로 업데이트된 객체의 데이타 대신 성공 여부 등의 메시지를 전달받는 경우, 유용하게 사용될 수 있다.
                    <br>parse 단계는 <a href="http://backbonejs.org/#Model-parse">Model.parse</a>를 참조한다.
                    <br><a href="https://github.com/inswave/w5grid-rest-node">w5grid-rest-node</a> 의 예제에서는 다음과 같은 response data 가 서버로부터 반환된다.</p>
                <pre><code class="language-javascript">  {
    "result": "success",
    "numberUpdated": 1
  }
</code></pre>
                <p>pick 옵션은 Row(Backbone.Model)의 특정 컬럼(property)의 데이타를 서버와 동기화합니다.
                    <br>pick 옵션을 사용할 경우, HTTP 메소드는 <code class="language-javascript">PATCH</code> 가 사용됩니다.</p>
                <pre><code class="language-javascript">  // 첫 번째 Row 의 phone1 과 phone2 컬럼의 데이타만 서버로 전송됩니다.
  data = { phone1: '504-621-8927', phone2: '504-845-1427' };
  grid1.row(0).set( 'data', data, { save: true, saved: true, pick: ['phone1', 'phone2'] } );
</code></pre>
                <p>update 와 delete 를 수행하기 위해서는 unique한 값을 가진 property 나 field 가 필요하며 이 때 클라이언트와 서버의 해당 요소가 서로 상이할 수 있다.
                    <br>MongoDB를 예로 들면 primary key 와 유사한 field 로 <a href="http://docs.mongodb.org/manual/reference/glossary/"><code class="language-javascript">_id</code></a> 를 이용하고 있다.
                    <br>이런 경우 Backbone 의 <a href="http://backbonejs.org/#Model-idAttribute">idAttribute</a> 를 이용하여 매핑합니다.</p>
                <pre><code class="language-javascript">  // Model 정의 시점에 서버에서 사용하는 id 필드를 지정합니다.
  // 아래 예제에서는 MongoDB 에서 사용하는 _id 를 지정합니다.
  // Collection 정의 시점에 model property 로 정의된 Model 을 지정합니다.
  var model = Backbone.Model.extend( { idAttribute: "_id" } ),
      List = Backbone.Collection.extend( { model: model, url: '/people' } ),
</code></pre>
                <p>서버 프로그램 예제는 아래와 같습니다.</p>
                <pre><code class="language-javascript">  // _id 필드값을 변수에 담아 둡니다.
  var _id = req.params._id;
  db.collection( 'people', function ( err, collection ) {

    // _id 를 key로 하여 클라이언트로 받은 데이타 중 _id 필드를 제외하고 update 합니다.
    req.body = _.omit( req.body, '_id');
    collection.update( { _id: ObjectID(_id) }, { $set: req.body }, function ( err, result ) {
      if (err) {
        res.json( { result: 'fail',
          message: err.message } );
      } else {
        res.json( { result: 'success',
          numberUpdated: result } );
      }
    });
  });
</code></pre>
                <p>addRow 메소드 실행 시 save 옵션을 지정하여 서버와 동기화를 합니다.
                    <br>success callback handler 를 지정하여 프로세스를 관리합니다.
                    <br>create 를 수행함으로 <code class="language-javascript">POST</code> HTTP 메소드를 사용합니다.</p>
                <pre><code class="language-javascript">  data = { "first_name": "shye", "last_name": "lee", "company_name": "inswave",
           "address": "guro", "city": "seoul", "county": "korea", "state": "guro", "zip": "1234",
           "phone1": "123-456-1234", "phone2": "789-123-4567",
           "email": "shye0919@inswave.com", "web": "http://www.inswave.com" };

  // 첫 번째 Row 를 추가하고 Server 에도 동기화를 수행합니다.
  // 다건(Array) add(insert) 도 단 건과 동일하게 동작합니다.
  grid1.addRow( 0, data, { save: true, success: function ( model, response, options ) {

    // success callback 의 두 번째 파라미터로 response data 를 받습니다.
    // 예제에서 _id 는 MongoDB 에 insert 시 자동으로 생성된 값입니다.
    console.log( 'create a Row ', _.omit( response, '_id' ) );
  }} );
</code></pre>
                <h2 id="destroy">Destroy</h2>
                <p>removeRow 옵션으로 destroy 를 지정하여 Row 삭제와 동시에 서버와 동기화를 합니다.
                    <br>addRow 와 같이 success callback handler 를 지정할 수 있습니다.
                    <br>delete 를 수행함으로 <code class="language-javascript">DELETE</code> HTTP 메소드를 사용합니다.</p>
                <pre><code class="language-javascript">  // 두 번째 Row 를 삭제하고 서버와 동기화를 합니다.
  grid1.removeRow( 1, { destroy: true, success: function ( model, response, options ) {
    console.log( 'removed the Row ', response.result );
  }});
</code></pre>
                <h2 id="sync">Sync</h2>
                <p><code class="language-javascript">urlCUD</code> property 와 <code class="language-javascript">syncData</code> 메소드를 이용하여 여러 차례 수행된 CUD 에 대한 서버 동기화를 한 번에 수행한다.</p>
                <p>Collection 정의 시 urlCUD 를 지정한다.</p>
                <pre><code class="language-javascript">  var List = Backbone.Collection.extend( { model: Model, url: '/people', urlCUD: '/mixed' } );
</code></pre>
                <p>syncData 메소드를 통해 화면에서 수행된 CUD 를 한 번에 서버와 동기화시킨다.</p>
                <pre><code class="language-javascript">  grid1.addRow( 0, { first_name: 'A' } );
  grid1.cell( 2, 1 ).set( 'data', 'BP' );
  grid1.removeRow(3);
  grid1.removeRow(10);
  grid1.cell( 6, 1 ).set( 'data', 'TD' );
  grid1.addRow( 4, { first_name: 'B' } );

  // 추가/수정/삭제에 대한 서버 동기화를 한 번에 수행한다.
  grid1.syncData( _.extend( options, { reset: true,
    success: function ( returnData, status, options ) {
      // callback 수행
    },
    error: function ( collection, response, options ) {
      // 에러 처리
    }
  }));
</code></pre>
                <p><code class="language-javascript">PATCH</code> HTTP 메소드를 이용하기 위해 <code class="language-javascript">pick</code> 옵션을 사용한다.</p>
                <ul>
                    <li>excludeCreate : create 된 항목을 서버 동기화에서 제외시킨다.</li>
                    <li>excludeUpdate : update 된 항목을 서버 동기화에서 제외시킨다.</li>
                    <li>excludeDelete : delete 된 항목을 서버 동기화에서 제외시킨다.</li>
                </ul>
                <pre><code class="language-javascript">  // saved 옵션은 서버 동기화 후 parse 단계를 skip 한다.
  // afterProcess 옵션은 create 항목에만 해당하는 사항으로 _id 처럼 서버에서 create 시점에 추가된 properties 들을 Client Model 에도 반영할 때 이용합니다.
  // 반환된 객체 - returnData- 의 create attribute 에 추가된 객체들이 Array 형태로 지정되어야 합니다.
  grid1.syncData( _.extend( options, { reset: true,
    pick: true, 
    saved: true, 
    excludeUpdate: true, 
    afterProcess: true,
    success: function ( returnData, status, options ) {
      // callback 수행
    },
    error: function ( collection, response, options ) {
      // 에러 처리
    }
  }));
</code></pre> 
            </section>
            <section>
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'w5-io'; /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script');
                        dsq.type = 'text/javascript';
                        dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
                </noscript> <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> 
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'w5-io'; /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var s = document.createElement('script');
                        s.async = true;
                        s.type = 'text/javascript';
                        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
                        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
                    }());
                </script>
            </section>
        </article>
    </div>
    <!-- FOOTER  -->
    <div id="footer_wrap">
        <footer class="inner clearfix">
            <div style="width:255px; float:right;">
                <a href="//plus.google.com/u/0/105292818602737285330?prsrc=3" rel="publisher" target="_blank" style="text-decoration:none; display:block; float:left; width:25px;">
                    <img src="//ssl.gstatic.com/images/icons/gplus-16.png" alt="Google+" style="border:0;width:25px;height:25px;" />
                </a> <a href="https://twitter.com/share" class="twitter-share-button" data-via="w5_io">Tweet</a> 
                <script>
                    ! function(d, s, id) {
                        var js, fjs = d.getElementsByTagName(s)[0],
                            p = /^http:/.test(d.location) ? 'http' : 'https';
                        if (!d.getElementById(id)) {
                            js = d.createElement(s);
                            js.id = id;
                            js.src = p + '://platform.twitter.com/widgets.js';
                            fjs.parentNode.insertBefore(js, fjs);
                        }
                    }(document, 'script', 'twitter-wjs');
                </script> <a href="https://twitter.com/w5_io" class="twitter-follow-button" data-show-count="false">Follow @w5_io</a> 
                <script>
                    ! function(d, s, id) {
                        var js, fjs = d.getElementsByTagName(s)[0],
                            p = /^http:/.test(d.location) ? 'http' : 'https';
                        if (!d.getElementById(id)) {
                            js = d.createElement(s);
                            js.id = id;
                            js.src = p + '://platform.twitter.com/widgets.js';
                            fjs.parentNode.insertBefore(js, fjs);
                        }
                    }(document, 'script', 'twitter-wjs');
                </script>
            </div>
        </footer>
    </div>
    <script src="../../../resources/js/jquery-1.11.1.min.js"></script>
    <script src="../../../resources/bootstrap/js/bootstrap.min.js"></script>
    <script src="../../../resources/prism/prism.js"></script>
    <script type="text/javascript">
        $("document").ready(function() {
            var gnbHref = $(".navbar-nav a[href!='#']"),
                tmpHref = "",
                lnb = $("#lnbList"),
                menuName = lnb.find("h1").text(),
                menuListEN = $("<h2>Basic</h2>" + "<ul>" + "<li><a href='../../basic/doc/createW5Grid.html'>Creating W5 Grid</a></li>" + "<li><a href='../../basic/doc/convertTable.html'>Converting a table to a W5 grid</a></li>" + "<li><a href='../../basic/doc/requireJS.html'>RequireJS</a></li>" + "</ul>" + "<h2>Cell</h2>" + "<ul>" + "<li><a href='../../cell/doc/displayType.html'>Display Type</a></li>" + "</ul>");
            menuListKO = $("<h2>Basic</h2>" + "<ul>" + "<li><a href='../../basic/doc/createW5Grid.ko.html'>W5 Grid 생성하기</a></li>" + "<li><a href='../../basic/doc/convertTable.ko.html'>Table을 W5 Grid로 변환하기</a></li>" + "<li><a href='../../basic/doc/requireJS.ko.html'>RequireJS</a></li>" + "</ul>" + "<h2>Cell</h2>" + "<ul>" + "<li><a href='../../cell/doc/displayType.ko.html'>Display Type</a></li>" + "</ul>"), language = document.location.href;
            if (language.indexOf(".ko.") > -1) {
                language = "ko";
                for (var i = 0; i < gnbHref.length; i++) {
                    tmpHref = gnbHref[i].href.substring(0, gnbHref[i].href.length - 5);
                    gnbHref[i].href = tmpHref + ".ko.html";
                }
            } else {
                language = "en";
            }
            $("html").attr("lang", language);
            $("#select-langue").val(language);
            if (menuName === "Samples") {
                switch (language) {
                    case "en":
                        lnb.append(menuListEN);
                        break;
                    case "ko":
                        lnb.append(menuListKO);
                        break;
                    default:
                        lnb.append(menuListEN);
                        break;
                }
            }
        });
        $("#select-langue").change(function() {
            var target, location, language;
            location = document.location.href;
            if (location.indexOf(".ko.") > -1) {
                language = "ko";
            } else {
                language = "en";
            } if (language === $(this).val()) {
                return;
            } else {
                if ($(this).val() === "ko") {
                    document.location.href = location.substring(0, location.length - 5) + ".ko.html";
                } else {
                    document.location.href = location.substring(0, location.length - 8) + ".html";
                }
            }
        });

        function openAlert(target) {
            var alertParent = $("#header_wrap"),
                alert, alertLeft = 0;
            alert = $("<div class='alert alert-warning alert-dismissable' style='position:absolute; top:100px; z-index:20;'>" + "<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>" + "<strong>Sorry!</strong> '" + $(target).text() + "' is under construction." + "</div>");
            alertParent.append(alert);
            alertLeft = alertParent.width() / 2 - alert.width() / 2;
            alert.css("left", alertLeft);
        }
    </script>
</body>

</html>