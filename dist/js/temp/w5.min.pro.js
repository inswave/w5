/*! w5 2014-12-22 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery","underscore","Backbone","exports"],function(c,d,e,f){a.w5=b(c,d,e,a,f)}):a.w5=b(a.jQuery||a.$,a._,a.Backbone,a,{})}(this,function(a,b,c,d,e){"use strict";function f(a,d,e,f,g){this.option=new c.Model(this.optionDefaultObject),this.colModel=d,this.view=e,this.collection=f,this.colLinker={},this.colInvertLinker=[],this.table=new this.MetaModel({id:"table"},{rowCID:"*",colID:"*"}),this.column=new c.Collection(null,{model:this.MetaModel}),this.row=new c.Collection(null,{model:this.MetaModel}),this.cell=new c.Collection(null,{model:this.MetaModel}),this.groupInfo={grouped:!1,groupRowCIDs:[],subTotalPosition:"header"},b(d).each(function(a,b){var c=a.id||a.headerLabel;if(!c)throw new Error("The column should be assigned one of id or headerLable.");this.colLinker[c]=b,this.colInvertLinker[b]=c},this),a.colOrder||(a.colOrder=this.colInvertLinker.slice()),this.option.set(a),b(d).each(function(a,c){b.chain(a).each(function(a,b){"id"!==b&&this.setMeta(["*",c],b,a,{inorder:!0})},this)},this),b.each(g||[],function(a){this.setMeta([a[0],a[1]],"style",a[2])},this)}function g(a,b){return new g.fn.init(a,b)}var h=function(){var a=[];return setInterval(function(){b(a).each(function(a){a.checkResize()})},200),{add:function(b){b.wrapper_width=b.$el.width(),a.push(b)}}}(),i=function(a){if(null===a)return"null";if(a&&(1===a.nodeType||9===a.nodeType))return"element";var b=Object.prototype.toString.call(a),c=b.match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===c){if(isNaN(a))return"nan";if(!isFinite(a))return"infinity"}return c};b.each(["Null","Undefined","Object","Array","String","Number","Boolean","Function","RegExp","Element","NaN","Infinite"],function(a){i["is"+a]=function(b){return i(b)===a.toLowerCase()}}),b.extend(f.prototype,{optionDefaultObject:{scrollLeft:0,scrollTop:0,frozenColumn:0,selectionMode:"cell",rowNum:10},metaDefaultObject:{width:100,headerLabel:"",readonly:!1,disabled:!1,displayType:"text",options:null,hidden:!1,dataType:null,format:"",className:""},metaDataTypes:{style:"object",option:"object",className:"className",disabled:!0,readOnly:!0,displayType:!0,options:!0},MetaModel:c.Model.extend({initialize:function(a,b){this.rowCID=b.rowCID,this.colID=b.colID,this.type="*"===this.rowCID&&"*"===this.colID?"table":"*"===this.rowCID?"column":"*"===this.colID?"row":"cell"}}),getModel:function(a,b,c){var d,e,f;return"*"===a&&"*"===b?this.table:("*"===a?(e=b,d=this.column):"*"===b?(e=a,d=this.row):(e=a+","+b,d=this.cell),f=d.get(e)||null,!f&&c&&(f=new this.MetaModel({id:e},{rowCID:a,colID:b}),d.push(f)),f)},setData:function(a,c,d){var f,g,h,i;if(d=d||{},this.collection.__validator&&b.isUndefined(d.validate)&&(d.validate=!0),a[1]=this.getColID(a[1],d.inorder),"*"===a[0]&&"*"===a[1])f=this.collection.reset(c,d);else if("*"===a[1]){c=this.checkDataType(c);for(h in c)i=this.getMeta([a[0],h],"dataType"),i&&(c[h]=e.dataType[i](c[h]));f=this.collection.at(a[0]).set(c,d)}else"*"===a[0]?(d.save=!1,d.targetColumn=a[1],this.collection.find(function(f,h){if(!(b(c).isArray()&&h>=c.length)){var j=b(c).isArray()?c[h]:c;return i=this.getMeta([h,a[1]],"dataType"),i&&(j=e.dataType[i](j)),g=f.set(a[1],j,d),g===!1}},this)):(i=this.getMeta([a[0],a[1]],"dataType"),i&&(c=e.dataType[i](c)),f=this.collection.at(a[0]).set(a[1],c,d));d.save===!0&&this.save(f,d)},checkNegativeValue:function(a){return b.isUndefined(a)||b.isNull(a)||""===a},getCheckValue:function(a){var c,d;return a=a||{},c=a.col||0,d=this.getMeta(["*",c],"options",a),d&&b.isArray(d)?(d=d[0].value,this.checkNegativeValue(d)&&(d=null)):d=null,d},runExpression:function(a,b,c){return a.call(this.view,{rowIndex:b,colId:c,attributes:this.collection.at(b).toJSON()})},getCellData:function(a,c,d){var e,f=this.getMeta([a,c],"expression");return b.isFunction(f)?(f=this.runExpression(f,a,c),b.isFunction(f)?(this.setMeta([a,c],"expression",f,{silent:!0}),e=this.runExpression(f,a,c)):e=f):e=b.isString(f)&&this.evalExpression?this.evalExpression(a,c,f):this.collection.at(a).get(c),d.formatted===!0?s.getFormattedData(e,a,c,this.view):e},getData:function(a,c){c=c||{};var d,e,f,g,h,i,j,k=c.type&&"array"===c.type.toLowerCase();return a[1]=this.getColID(a[1],c.inorder),"*"===a[1]?(d="*"!==a[0],e=d?[this.collection.at(a[0])]:this.collection.models,c.checked&&(g=this.getCheckValue(c),null===g)?[]:(f=b.reduce(e,function(a,d){return c.checked&&(h=d.get(this.getColID(0,c.inorder)),b.isUndefined(h)||b.isNull(h)||-1===h.indexOf(g))?a:(i=c.pick===!0||k?this.colInvertLinker:c.pick?b.intersection(this.colInvertLinker,c.pick):c.omit?b.difference(this.colInvertLinker,c.omit):d.keys(),j=b.map(i,function(a){return this.getCellData(d.collection.indexOf(d),a,c)},this),a.push(k?j:b.object(i,j)),a)},[],this),d?f[0]:f)):"*"===a[0]?this.collection.map(function(b,d){return this.getCellData(d,a[1],c)},this):this.getCellData(a[0],a[1],c)},getDataLength:function(){return this.collection.length},getDataCID:function(a){return"*"===a||b(a).isString()?a:this.collection.at(a).cid},getMetaIndex:function(a){return this.collection.indexOf(this.collection.get(a))},setMeta:function(a,c,d,e){e=e||{},a[1]=this.getColID(a[1],e.inorder);var f=this.getModel(this.getDataCID(a[0]),a[1],!0),g={uid:b.uniqueId()};e.alter&&f.has(c)&&(g=f.get(c)),g.value="width"===c||"height"===c?parseInt(d,10):d,f.set(c,"id"===c?d:g,e)},getMeta:function(a,c,d){var e,f,g,h=this.getDataCID(a[0]);if(d=d||{},a[1]=this.getColID(a[1],d.inorder),e=this.getModel(h,a[1]),"*"===a[0]||"*"===a[1]||d.noncomputed)f=e&&e.has(c)?b.isObject(e.get(c))?e.get(c).value:e.get(c):this.metaDefaultObject[c];else switch(g=b([e,this.getModel("*",a[1]),this.getModel(h,"*"),this.getModel("*","*")]).compact(),g=b(b.map(g,function(a){return a.get(c)})).compact(),0===g.length&&(g=[{uid:-1,value:this.metaDefaultObject[c]}]),this.metaDataTypes[c]){case"object":g=b(g).sortBy(function(a){return parseInt(a.uid,10)}),f=b(g).reduce(function(a,c){return b.extend(a,c.value)},{});break;case"className":f=b.union(b.pluck(g,"value").join(" ").split(/\s+/)).join(" ");break;default:f=b.max(g,function(a){return parseInt(a.uid,10)}).value}return f},hasMeta:function(a,b,c,d){d=d||{},a[1]=this.getColID(a[1],d.inorder);var e=this.getModel(this.getDataCID(a[0]),a[1]);return!!e&&e.has(b)},removeMeta:function(a,b,c){c=c||{},a[1]=this.getColID(a[1],c.inorder);var d=this.getModel(this.getDataCID(a[0]),a[1]);d&&d.unset(b,c)},removeMetaByDataCID:function(a){var c=this.cell.length,d=b.filter(this.cell.models,function(b){return-1===b.id.indexOf(a)});c>d.length&&this.cell.reset(d,{silent:!0}),this.row.remove(this.row.get(a),{silent:!0})},setOption:function(){return this.option.set.apply(this.option,arguments)},getOption:function(){return this.option.get.apply(this.option,arguments)},getColID:function(a,c){return"*"===a||b(a).isString()?a:b(a).isNumber()?c?this.colInvertLinker[a]:this.visibleCol[a]:null},getColIndex:function(a,c){return"*"===a||b(a).isNumber()?a:b(a).isString()?c?this.colLinker[a]:b(this.visibleCol).indexOf(a):null},updateVisibleCol:function(){var a=this.getOption("colOrder");this.visibleCol=b.reduce(a,function(a,b){return this.getMeta(["*",b],"hidden")||a.push(b),a},[],this)},getVisibleCol:function(){return this.visibleCol},getFrozenArea:function(){return b.reduce(b.range(this.getOption("frozenColumn")),function(a,b){return a+this.getMeta(["*",b],"width")},0,this)},makeJSONfromArray:function(a){var c=b.keys(this.colLinker),d=b.isArray(a[0])?!0:!1;return a=d?b.map(a,function(a){return b.object(c,a)},this):b.object(c,a)},checkDataType:function(a){if(b.isArray(a))i.isObject(a[0])||(a=this.makeJSONfromArray(a));else if(!i.isObject(a))throw new TypeError("Array, JSON data types allow only.");return a},addRow:function(a,c,d){var e,f=0;d=d||{},0===arguments.length?(c={},a=null):1===arguments.length?b.isNumber(arguments[0])?c={}:(c=this.checkDataType(a),a=null):arguments.length>=2&&(b.isObject(arguments[0])&&(d=c,c=a,a=null),c=this.checkDataType(c)),0===a?e=this.collection.unshift(c,d):(a&&(d.at=a),e=this.collection.add(c,d)),d.group||(b.isArray(e)?b.each(e,function(a){a.__isNew=!0,f+=1}):(e.__isNew=!0,f+=1),d.save===!0&&(b.isArray(e)&&1===e.length?this.save(e[0],d):this.save(e,d)),d.silent||(a=b.isNull(a)?this.getDataLength()-1:a,d.focus===!0?((a>=this.view.rowTop+this.getOption("rowNum")||a<this.view.rowTop)&&this.setOption("scrollTop",20*a),this.view.setFocusedCell(a,0)):this.view.focusedCell&&this.view.focusedCell.rowIndex>=a&&this.view.setFocusedCell(this.view.focusedCell.rowIndex+f,this.view.focusedCell.colIndex),this.view.trigger("addRow",{type:"addRow"},{index:a,addedCount:f})))},removeRow:function(a,d){var e,f,g=[],h=-1,i=0;a=b.isArray(a)?a:[a],0!==a.length&&(d=d||{},e=b.reduce(a,function(a,f){return b.isString(f)&&(f=this.collection.get(f)),f instanceof c.Model&&(f=this.collection.indexOf(f)),b.isNumber(f)&&(e=this.collection.at(f),!e||!d.group&&this.getMeta([f,"*"],"group")||(this.removeMetaByDataCID(e.cid),a.push(e),g.push(f))),a},[],this),e.length>0&&(this.view.focusedCell&&(h=this.view.focusedCell.rowIndex),d.destroy&&1===e.length&&(d.url=b.result(e[0],"url")),e=this.collection.remove(e,d),d.group||(f=b.reduce(e,function(a,b){return b.__isNew||a.push(b),a},[]),Array.prototype.push.apply(this.collection.__removeModels,f),d.destroy&&1===e.length&&this.destroy(e[0],d),d.silent||(h>-1&&(b.each(g,function(a){h>a?i+=1:h===a&&h>=this.view.getRowLength()&&(i+=1)},this),i>0&&this.view.setFocusedCell(this.view.focusedCell.rowIndex-i,this.view.focusedCell.colIndex)),this.view.trigger("removeRow",{type:"removeRow"},{index:g.slice(),removedRow:b(e).map(function(a){return a.toJSON()})})))))},removedRow:function(a){return a&&a.ref?this.collection.__removeModels:b(this.collection.__removeModels).map(function(a){return a.toJSON()})},sort:function(a,c,d){var e=0,f=this.collection.sortInfo,g={before:{columns:b.isFunction(f.column)?null:f.column.slice(),directions:f.direction.slice()},after:{columns:null,directions:null}};for(d=d||{},b.isUndefined(a)?f.column=[]:b.isFunction(a)?f.column=a:((b.isNumber(a)||b.isString(a))&&(a=[a]),a=b.map(a,function(a){return this.getColID(a)},this),f.column=a),b.isUndefined(c)||b.isNull(c)?f.direction=b.isUndefined(a)?[]:["asc"]:(b.isString(c)&&(c=[c]),f.direction=c);e<f.column.length;)f.direction[e]=f.direction[e]?f.direction[e].toLowerCase():"asc",e+=1;g.after.columns=b.isFunction(f.column)?null:f.column.slice(),g.after.directions=f.direction.slice(),!d.group&&this.groupInfo.grouped?(d.sort=!0,this.group.call(this,f.column.slice(),f.direction.slice(),null,d)):this.collection.sortData(d),d.silent||this.view.trigger("sort",{type:"sort"},g)},wrapRoot:function(a,b){var c;return b.rootName&&(c={},c[b.rootName]=a,a=c),a},convertJSONtoXML:function(a,c){var d;return a=a||{},d=c.data?c.data:b.isString(a)?JSON.parse(a):a.toJSON(),c.converter?d=c.converter.json2xml_str.call(c.converter.json2xml_str,d,c):this.view.options.xmlConverter&&(d=this.wrapRoot(d,c),d=this.view.options.xmlConverter.json2xml_str(d)),d},sendXML:function(c,d){var e=this;return d=d||{},d.type=d.type||"POST",d.contentType=d.contentType||"application/xml",d.dataType=d.dataType||"xml",d.processData=!1,this.view.options.xmlConverter&&(d.defaultXMLConverter=this.view.options.xmlConverter),d.data=this.convertJSONtoXML(c,d),d.converters={"text xml":function(c){var f;return c=a.parseXML(c),d.converter?c=d.converter.xml2json.call(d.converter.xml2json,c,d):e.view.options.xmlConverter&&(c=e.view.options.xmlConverter.xml2json(c),d.targetPath&&(b.isString(d.targetPath)?(f=d.targetPath.split("."),c=b.reduce(f,function(a,b){return a[b]},c)):b.isFunction(d.targetPath)&&(c=d.targetPath(c)))),c}},d},fetch:function(a,b){arguments.length>0?(i.isNumber(a)?a=this.collection.at(a):a instanceof c.Collection||a instanceof c.Model||(b=a,a=this.collection),b&&b.contentType&&b.contentType.indexOf("xml")>-1&&(b=this.sendXML(a,b))):a=this.collection,a.fetch(b)},save:function(a,c){var d,e,f=c.success;c=c||{},b.isArray(a)||(d=this.collection.indexOf(a),c.formatted||c.pick||c.omit?(e=this.getData([d,"*"],c),c.patch=!0):e=null,c.success=function(b,d){a.__isNew=!1,f&&f(b,d,c)},c.contentType&&c.contentType.indexOf("xml")>-1&&(c.patch&&(c.data=e),c=this.sendXML(a,c)),this.collection.at(d).save(e,c))},destroy:function(a,c){var d=this,e=c.success;b.isArray(a)||(c.contentType&&c.contentType.indexOf("xml")>-1&&(c=this.sendXML(a,c)),c.success=function(a,f){b.each(d.collection.__removeModels,function(b,c,d){a.id===b.id&&d.splice(c,1)}),e&&e(a,f,c)},a.destroy(c))},getCUData:function(a){a=a||{};var c={createList:[],updateList:[],deleteList:[]},d=a.excludeCreate||!1,e=a.excludeUpdate||!1,f=a.excludeDelete||!1;return d&&e||(c=b.reduce(this.collection.models,function(b,c){return!d&&c.__isNew?b.createList.push(a.ref?c:c.toJSON()):!e&&c.hasChanged()&&b.updateList.push(a.ref?c:c.toJSON()),b},c,this)),f||Array.prototype.push.apply(c.deleteList,this.removedRow(a)),c},syncData:function(a){var d,e,f,g=this,h=b.extend({},c.Events,{url:this.collection.compoundURL});return a=a||{},f=a.success,a.modified===!0?(a.ref=!0,d=this.getCUData(a),e=d.createList.slice(),h=b.extend(h,{getJSON:function(c){b.each(c,function(b,c,d){d[c]=g.getData([b.collection.indexOf(b),"*"],a)},g)},toJSON:function(){return(a.formatted||a.pick||a.omit)&&(this.getJSON(d.createList),this.getJSON(d.updateList)),d}})):h=b.extend(h,{toJSON:function(){return d=a.checked||a.formatted||a.pick||a.omit?g.getData(["*","*"],a):g.collection.toJSON()}}),a&&a.contentType&&a.contentType.indexOf("xml")>-1&&(a=this.sendXML(JSON.stringify(h.toJSON()),a)),a.success=function(c,d){a.excludeDelete||(g.collection.__removeModels=[]),b.each(e,function(b,d){b.__isNew=!1,a.afterProcess&&c.createList&&c.createList[d]&&b.set(c.createList[d])}),f&&f(c,d,a)},c.sync("create",h,a)},getGridData:function(){return this.collection},setDefaults:function(a){this.collection.defaults=a},getDefaults:function(){var a=null;return i.isFunction(this.collection.defaults)?a=this.collection.defaults():i.isObject(this.collection.defaults)&&(a=b.clone(this.collection.defaults)),a}});var j={parse:function(a,c){if(c.saved)a=this.attributes;else if(b.isString(a)&&(a=JSON.parse(a)),this.collection&&b.isArray(a))return this.parseWithDataType(this.collection.keys,a,this.collection.grid?this.collection.grid.options.colModel:null);return a},defaults:function(){return this.collection&&this.collection.defaults?i.isFunction(this.collection.defaults)?this.collection.defaults.call(this):this.collection.defaults:void 0},parseWithDataType:function(a,b,c){for(var d,f={},g=0,h=a.length;h>g;g++)c&&(d=c[g].dataType,d&&(b[g]=e.dataType[d](b[g]))),f[a[g]]=b[g];return f}},k={__validator:null,__invalidCallback:null,__sorting:!1,__filtering:!1,__originalCollection:null,defaults:null,initialize:function(a,b){b&&(this.grid=b.grid,this.keys=b.keys,this.url=b.url,this.compoundURL=b.compoundURL,this.defaults=b.defaults,this.__removeModels=[])},clone:function(){return new this.constructor(this.models,{grid:this.grid,keys:this.keys})},parse:function(a){return b.isString(a)?JSON.parse(a):a},cloneCollection:function(){this.__originalCollection||(this.__originalCollection=this.clone(),this.__originalCollection.listenTo(this,"add remove",this.syncData))},resetCollection:function(a){"filter"===a?this.__sorting?(this.reset(this.__originalCollection.models,{silent:!0}),this.sortData()):(this.reset(this.__originalCollection.models),this.__originalCollection.stopListening(this,"add remove",this.syncData),this.__originalCollection=null):"sort"===a&&(this.__filtering?(this.reset(this.__originalCollection.models,{silent:!0}),this.filterData(!0,{})):(this.reset(this.__originalCollection.models),this.__originalCollection.stopListening(this,"add remove",this.syncData),this.__originalCollection=null))},syncData:function(a,c,d){var e;d.add?(0===d.at?e=this.indexOf(c.at(1)):(e=c.indexOf(a)-1,e=this.indexOf(c.at(e))+1),this.add(a,b.extend(d,{at:e,silent:!0}))):(e=this.indexOf(a),this.remove(a,b.extend(d,{index:e,silent:!0})))},sortInfo:{column:[],direction:[],comparator:function(a,c){if(!this.sortInfo.column)return 0;var d,e=this.sortInfo.column,f=this.sortInfo.direction;if(d=b.find(e,function(b){return a.attributes[b]!==c.attributes[b]}),!d){var g=a.collection.__originalCollection||a.collection,h=g.indexOf(a),i=g.indexOf(c);return h>i?1:-1}return"asc"===f[b.indexOf(e,d)]?b.isUndefined(c.attributes[d])?1:a.attributes[d]>c.attributes[d]?1:-1:b.isUndefined(a.attributes[d])?1:a.attributes[d]<c.attributes[d]?1:-1}},sortData:function(a){this.sortInfo.column.length>0?(this.cloneCollection(),this.__sorting=!0,this.comparator=b.isFunction(this.sortInfo.column)?this.sortInfo.column:this.sortInfo.comparator,this.sort(a)):this.__sorting&&(this.__sorting=!1,this.comparator=null,this.resetCollection("sort"))}},l=null,m=null,n=/\s+/,o=[/^[^\[\s]+\[[^\]]+\]|^[^\[\s]+/g,/(^[^\[\]:]*)(\[[^\]]+\])?(?::(\w+$))?/g],p=c.View.prototype,q={template:b.template("<<%= tagName %> id='<%= id %>' class='gGrid<%= className %>' style='width:<%= width %>;<%= style %>'><div class='gGrid-setTable'><div class='w5_grid_editbox' contenteditable='true'></div><table class='gGrid-table' style='width:0'><caption class='gGrid-caption'><%= caption %></caption><colgroup></colgroup><thead></thead><tbody></tbody></table><div class='w5-grid-select-area hide'></div><div class='w5-grid-focused-cell border-top hide'></div><div class='w5-grid-focused-cell border-right hide'></div><div class='w5-grid-focused-cell border-bottom hide'></div><div class='w5-grid-focused-cell border-left hide'></div><div class='adjustCol-handle-hover hide'></div><div class='frozenHandle hide'></div><div class='frozenHandle-move hide'></div><div class='columnMove-start hide'></div><div class='columnMove-move hide'></div><div class='columnMove-indicator hide'><span class='columnMove-indicator-arrow'></span><span class='columnMove-indicator-bar'></span></div><div class='adjustCol-start hide'><span class='adjustCol-start-icon'></span></div><div class='adjustCol-move hide'><span class='adjustCol-move-icon'></span></div><div class='gScroll-v'><button class='scrollHandler'>Move vertical scroll</button></div><div class='gScroll-h'><button class='scrollHandler'>Move horizontal scroll</button></div></div></<%= tagName %>>"),events:{"dblclick .gGrid-table>thead":function(a){this.sortColumn.dblClickEvent.call(this,a)},"mousedown .gGrid-table>thead":function(a){this.columnMove.downEvent.call(this,a)},"click .gGrid-table>tbody":function(a){this.clickCell.clickEvent.call(this,a)},"dblclick .gGrid-table>tbody":function(a){this.clickCell.clickEvent.call(this,a)},"mousedown .frozenHandle":function(a){this.frozenColumn.downEvent.call(this,a)},"mousedown .gScroll-v":function(a){this.verticalScroll.areaDownEvent.call(this,a)},"mousedown .gScroll-v .scrollHandler":function(a){this.verticalScroll.handleDownEvent.call(this,a)},"touchstart .gScroll-v .scrollHandler":function(a){this.verticalScroll.handleDownEvent.call(this,a)},"mousedown .gScroll-h":function(a){this.horizontalScroll.areaDownEvent.call(this,a)},"mousedown .gScroll-h .scrollHandler":function(a){this.horizontalScroll.handleDownEvent.call(this,a)},"touchstart .gScroll-h .scrollHandler":function(a){this.horizontalScroll.handleDownEvent.call(this,a)},mousewheel:function(a){this.scrollByWheel.wheelEvent.call(this,a)},"keydown .w5_grid_editbox":"handleKeydown","keydown .gGrid-table>tbody":"handleKeydown"},keydownEvents:{38:"moveUp",40:"moveDown",37:"moveLeft",39:"moveRight",13:"focusWidget",113:"focusWidget",27:"blurWidget",9:"moveActionableItem",36:"jumpTo",35:"jumpTo",33:"jumpTo",34:"jumpTo"},keySet:{UP:38,DOWN:40,LEFT:37,RIGHT:39,ENTER:13,F2:113,ESC:27,TAB:9,HOME:36,END:35,PageUP:33,PageDOWN:34},initialize:function(a){this.options=a,a.parseTable&&(this.parseTable(a),!this.collection&&a.collection&&(this.collection=a.collection));var d=b.map(a.colModel,function(a){return"headerLabel"in a||(a.headerLabel=a.id),a.id||a.headerLabel}),e=a.defaults||b.object(d,b.pluck(a.colModel,"default")),g=this;!this.id&&this.$el&&this.$el.attr("id")&&(this.id=this.$el.attr("id")),b.isBoolean(a.emulateHTTP)&&(c.emulateHTTP=a.emulateHTTP),a.collection instanceof c.Collection?(b.extend(this.collection.constructor.prototype.model.prototype,j,l),b.extend(this.collection.constructor.prototype,k,m),k.initialize.call(this.collection,null,{grid:g,keys:a.collection.keys?a.collection.keys:d,url:a.collection.url,compoundURL:a.collection.compoundURL,defaults:a.collection.defaults?a.collection.defaults:e})):this.collection=new y(a.collection,{grid:this,keys:d,defaults:e,parse:!0}),this.viewModel=new f(a.option,a.colModel,this,this.collection,a.style),a.validator&&this.setValidator(a.validator),b.isFunction(a.invalidCallback)&&this.setInValidCallback(a.invalidCallback),a.fetch&&this.viewModel.fetch(this.collection,b.extend({reset:!0},a.fetch)),this.isBasic=b.isUndefined(this.collection.filterInfo),this.isMobile=this.detectMobile.any(),this.tabbableElements=["checkbox"],this.listenTo(this.collection,"change",this.onModelChange),this.listenTo(this.collection,"add remove",this.onModelAddRemove),this.listenTo(this.collection,"reset sort",this.onReset),this.listenTo(this.collection,"sync",this.drawWhole),this.listenTo(this.viewModel.table,"change",this.drawMetaByPos),this.listenTo(this.viewModel.column,"change",this.drawMetaByPos),this.listenTo(this.viewModel.row,"change",this.drawMetaByPos),this.listenTo(this.viewModel.cell,"change",this.drawMetaByPos),this.listenTo(this.viewModel.option,"change",this.onOptionChange),this.setGridEvents()},render:function(){var b,c;return this.viewModel.updateVisibleCol(),b=a(this.template({tagName:this.tagName||"div",id:this.id,className:this.className?" "+this.className:"",style:this.$el[0].style.cssText?" "+this.$el[0].style.cssText:"",width:this.viewModel.getOption("width"),caption:this.viewModel.getOption("caption")})),this.$el.replaceWith(b),this.$el=b,c=this.$(".gGrid-setTable"),this.$wrapper_div=c,this.tableWidth=c.width(),this.wholeTblWidth=this.getWholeTblWidth(),this.rowTop=0,this.rowNum=this.$("tbody tr").length,this.startCol=0,this.endCol=this.$("colgroup col").length,this.$scrollYArea=this.$(".gScroll-v"),this.$scrollYHandle=this.$(".gScroll-v .scrollHandler"),this.$scrollXArea=this.$(".gScroll-h"),this.$scrollXHandle=this.$(".gScroll-h .scrollHandler"),this.$editBox=this.$(".w5_grid_editbox"),this.scrollYHandleMinHeight=parseInt(this.$scrollYHandle.css("min-height"),10),this.scrollXHandleMinWidth=parseInt(this.$scrollXHandle.css("min-width"),10),this.addEvents(),this.setResize(),this.headNum=this.$("thead tr").length,this.trigger("render",{type:"render"}),this},detectMobile:{userAgent:navigator.userAgent,android:function(){return/Android/i.test(this.userAgent)},blackBerry:function(){return/BlackBerry/i.test(this.userAgent)},iOS:function(){return/iPhone|iPad|iPod/i.test(this.userAgent)},opera:function(){return/Opera Mini/i.test(this.userAgent)},windows:function(){return/IEMobile/i.test(this.userAgent)},any:function(){return this.iOS()||this.android()||this.blackBerry()||this.opera()||this.windows()}},setGridEvents:function(){var a,b={};for(a in this.options.gridEvents){var c=a.split(n);b[c[0]]||(b[c[0]]=[]),b[c[0]].push({select:c.splice(1).join(" "),funcName:this.options.gridEvents[a]})}this.gridEventMatch=b;for(a in b)"change"!==a&&(this.events[a+" td"]="handleCommonEvent");this.delegateEvents(this.events)},handleCommonEvent:function(b){var c,d,e,f,g,h=this.gridEventMatch[b.type]||[],i={};h.length>0&&(c=a(b.target).closest("td"),d=c.index(),e=c.parent().index()+this.rowTop,f=this.viewModel.getDataCID(e),g=this.viewModel.getOption("frozenColumn"),d>=g&&(d+=this.startCol-g),d=this.viewModel.getColID(d,!0),i.rowIndex=e,i.colID=d,this.fireGridEvent(h,f,d,b,i,!1))},fireGridEvent:function(a,c,d,e,f,g){var h,i,j;for(h=0;h<a.length;h++)for(j=this.select(a[h].select),i=0;i<j.length;i++)this.viewModel.getDataCID(j[i][0])===c&&j[i][1]===d&&(g||"TD"!==e.target.tagName||!j[i].pseudo||"items"!==j[i].pseudo)&&(b.isString(a[h].funcName)?this.options[a[h].funcName].call(this,e,f):b.isFunction(a[h].funcName)&&a[h].funcName.call(this,e,f))},parseTable:function(c){if("TABLE"===this.$el[0].tagName){var d,e,f=this.$("tr"),g=a(f[0]),h=[],i=[];f=a(b(f).rest()),b(g.find("td")).each(function(b){var c,d=a(b),e=parseInt(d.attr("colspan"),10)||1;for(h.push(d.width()),i.push(d.text()),c=1;e>c;c++)h.push(0),i.push("")}),c.colModel=b(i).map(function(a,b){return{headerLabel:a,width:h[b]}}),e=b.map(c.colModel,function(a){return a.id||a.headerLabel}),d=b(f).map(function(c){return b(a(c).find("td")).map(function(b){return a(b).text()})}),c.collection=new y(d,{keys:e,parse:!0}),c.style=[],b(f).each(function(d,e){b(a(d).find("td")).each(function(d,f){var g=a(d).attr("style")||"",h=b(g.split(/;+\s*/g)).reduce(function(a,b){var c=b.split(/:/);return 2===c.length&&(a||(a={}),a[c[0]]=c[1]),a},null);h&&c.style.push([c.collection.at(e).cid,i[f],h])})})}},createTbody:function(){var c,d,e,f,g=this.$("tbody"),h=this.$("colgroup"),i=this.viewModel.getOption("rowNum"),j=this.viewModel.getVisibleCol(),k=0,l="";for(this.$("col").remove(),this.$("tr").remove(),f=0;f<j.length;f++)if(k+=this.viewModel.getMeta(["*",f],"width"),l+="<col style='width:"+this.viewModel.getMeta(["*",f],"width")+"px'>",k>=this.tableWidth){f++;break}for(i=Math.min(i,this.collection.length),c=0;i>c;c++){for(e=a("<tr class='gGrid-row'>"),d=0;f>d;d++)e.append("<td>");g.append(e)}h.append(l),e=a("<tr>"),b(b.range(f)).each(function(){var b=a("<th class='gGrid-headerLabel' scope='col'><div class='gGrid-headerLabelWrap'></th>");e.append(b)},this),this.$wrapper_div.find("thead").append(e)},addEvents:function(){var a=this;this.$editBox.on("blur",function(b){t.text.endEdit.call(t.text,b,a)}),this.delegateEvents(),h.add(this)},sortColumn:{dblClickEvent:function(b){var c=a(b.target).closest("th"),d=c.index(),e=this.viewModel.getOption("frozenColumn"),f=e>d?d:d+this.startCol-e;this.viewModel.getMeta(["*",f],"sortable")!==!1&&this.sortColumn.sortColumn.call(this,f),a("document").addClass("noselect")},sortColumn:function(a){var c=b.isFunction(this.collection.sortInfo.column)?[]:this.collection.sortInfo.column.slice()||[],d=this.collection.sortInfo.direction.slice()||[],e=this.viewModel.getColID(a),f=b.indexOf(c,e),g=-1===f?0:"asc"===(d[f]||"asc")?1:2;g=(g+1)%3,0===g?(c.splice(f,1),d.splice(f,1)):-1===f?(c.push(e),d.push(1===g?"asc":"desc")):d[f]=1===g?"asc":"desc",this.sort(c,d)}},columnMove:{draggedColumn:null,_wrapMoveEvent:null,_wrapUpEvent:null,$pickTH:null,dragInfo:{startX:null,indicatorMovePosX:null,increasedX:null},_downEvent:function(c){var d,e,f=this.viewModel.getOption("colOrder"),g=this.viewModel.getVisibleCol();this.columnMove.$indicator=this.$(".columnMove-indicator"),this.columnMove.$indicatorStart=this.$(".columnMove-start"),this.columnMove.$indicatorMove=this.$(".columnMove-move"),this.columnMove.$pickTH=a(c.target).closest("th"),this.columnMove.dragInfo.startX=c.clientX,this.columnMove.dragInfo.indicatorMovePosX=this.columnMove.$pickTH.position().left,this.columnMove.$pickTH.length>0&&(d=this.columnMove.$pickTH.index(),e=this.viewModel.getOption("frozenColumn"),this.columnMove.draggedColumn=e>d?d:d+this.startCol-e),f[this.columnMove.draggedColumn]!==g[this.columnMove.draggedColumn]&&(this.columnMove.draggedColumn=b(f).indexOf(g[this.columnMove.draggedColumn])),a("body").addClass("noselect")},downEvent:function(a){var c;"BUTTON"!==a.target.tagName&&(a.target.className.indexOf("gGrid-headerLabelText")>-1||a.target.className.indexOf("gGrid-headerLabelWrap")>-1||a.target.className.indexOf("w5-grid-sort")>-1)&&(this.columnMove._downEvent.call(this,a),c=this,this.columnMove._wrapMoveEvent=function(a){c.columnMove.moveEvent.call(this,a)},this.columnMove._wrapUpEvent=function(a){c.columnMove.upEvent.call(this,a)},this.columnMove._wrapMoveEvent=b.bind(this.columnMove._wrapMoveEvent,this),this.columnMove._wrapUpEvent=b.bind(this.columnMove._wrapUpEvent,this),document.body.addEventListener("mousemove",this.columnMove._wrapMoveEvent,!0),document.body.addEventListener("mouseup",this.columnMove._wrapUpEvent,!0))},_moveEvent:function(c){var d,e,f,g=a(c.target).closest("th"),h=this.viewModel.getOption("colOrder"),i=this.viewModel.getVisibleCol();this.columnMove.dragInfo.increasedX=c.clientX-this.columnMove.dragInfo.startX,this.columnMove.$indicatorStart.css({left:this.columnMove.dragInfo.indicatorMovePosX,width:this.columnMove.$pickTH.width()-2}).removeClass("hide"),this.columnMove.$indicatorMove.css({left:this.columnMove.dragInfo.indicatorMovePosX+this.columnMove.dragInfo.increasedX,width:this.columnMove.$pickTH.width()}).removeClass("hide"),g.length>0&&(d=g.index(),e=this.viewModel.getOption("frozenColumn"),f=e>d?d:d+this.startCol-e,h[f]!==i[f]&&(f=b(h).indexOf(i[f])),f===this.columnMove.draggedColumn?(this.columnMove.$indicator.addClass("hide"),a("body").addClass("not-allowed"),(c.target.className.indexOf("gGrid-headerLabelWrap")>-1||c.target.className.indexOf("gGrid-headerLabelText")>-1||c.target.className.indexOf("w5-grid-sort")>-1)&&a(c.target).closest("th").addClass("not-allowed").removeClass("allowed")):(this.columnMove.$indicator.removeClass("hide").css({left:g.position().left+(f<this.columnMove.draggedColumn?0:g.outerWidth())-3}),(c.target.className.indexOf("gGrid-headerLabelWrap")>-1||c.target.className.indexOf("gGrid-headerLabelText")>-1||c.target.className.indexOf("w5-grid-sort")>-1)&&a(c.target).closest("th").addClass("allowed").removeClass("not-allowed")))},moveEvent:function(a){this.columnMove.draggedColumn>-1&&this.columnMove._moveEvent.call(this,a)},_upEvent:function(c){var d,e,f,g=a(c).closest("th"),h=this.viewModel.getOption("colOrder"),i=this.viewModel.getVisibleCol();g.length>0&&(d=g.index(),e=this.viewModel.getOption("frozenColumn"),f=e>d?d:d+this.startCol-e,h[f]!==i[f]&&(f=b(h).indexOf(i[f])),this.columnMove.draggedColumn!==f&&this.moveColumn(this.columnMove.draggedColumn,f)),a("body").removeClass("noselect").removeClass("not-allowed"),g.removeClass("allowed").removeClass("not-allowed"),this.columnMove.$indicator.addClass("hide").removeClass("show"),this.columnMove.$indicatorStart.addClass("hide"),this.columnMove.$indicatorMove.addClass("hide"),this.columnMove.draggedColumn=null},upEvent:function(a){this.columnMove._upEvent.call(this,a.target),document.body.removeEventListener("mousemove",this.columnMove._wrapMoveEvent,!0),document.body.removeEventListener("mouseup",this.columnMove._wrapUpEvent,!0)}},frozenColumn:{frozenColumnIdx:null,newFrozenCol:-1,dragInfo:{},_wrapMoveEvent:null,_wrapUpEvent:null,_downEvent:function(a){this.frozenColumn.frozenColumnIdx=this.viewModel.getOption("frozenColumn"),this.frozenColumn.dragInfo={startX:a-this.$wrapper_div.offset().left,endX:0}},downEvent:function(a){var c=this;this.frozenColumn._downEvent.call(this,a.clientX),this.frozenColumn.$frozenHandle=this.$(".frozenHandle"),this.frozenColumn.$seperateCol=this.$(".frozenHandle-move"),this.frozenColumn.$indicator=this.$(".columnMove-indicator"),this.frozenColumn._wrapMoveEvent=function(a){c.frozenColumn.moveEvent.call(this,a)},this.frozenColumn._wrapUpEvent=function(a){c.frozenColumn.upEvent.call(this,a)},this.frozenColumn._wrapMoveEvent=b.bind(this.frozenColumn._wrapMoveEvent,this),this.frozenColumn._wrapUpEvent=b.bind(this.frozenColumn._wrapUpEvent,this),document.body.addEventListener("mousemove",this.frozenColumn._wrapMoveEvent,!0),document.body.addEventListener("mouseup",this.frozenColumn._wrapUpEvent,!0)},_moveEvent:function(a){var b,c=-1,d=0,e=0,f=this.viewModel.getVisibleCol(),g=this.frozenColumn.$indicator.width();for(this.frozenColumn.dragInfo.endX=a-this.$wrapper_div.offset().left,this.frozenColumn.$seperateCol.css("left",this.frozenColumn.dragInfo.endX),this.frozenColumn.$seperateCol.removeClass("hide").addClass("show"),this.frozenColumn.newFrozenCol=-1,b=0;b<f.length;b++)if(d=this.viewModel.getMeta(["*",b],"width"),e+=d,-1===this.frozenColumn.newFrozenCol)e-d/2>=this.frozenColumn.dragInfo.endX&&(this.frozenColumn.newFrozenCol=c=b,e=d);
else if(c=b,e>this.$wrapper_div.width())break;if(this.frozenColumn.frozenColumnIdx!==this.frozenColumn.newFrozenCol)for(e=0,b=0;b<this.frozenColumn.newFrozenCol;b++)e+=this.viewModel.getMeta(["*",b],"width");this.frozenColumn.$indicator.removeClass("hide").addClass("show").css("left",e-g/2)},moveEvent:function(a){this.frozenColumn._moveEvent.call(this,a.clientX)},_upEvent:function(){this.viewModel.setOption("frozenColumn",this.frozenColumn.newFrozenCol),this.frozenColumn.$seperateCol.removeClass("show").addClass("hide"),this.frozenColumn.$indicator.removeClass("show").addClass("hide")},upEvent:function(a){this.frozenColumn._upEvent.call(this,a.target),document.body.removeEventListener("mousemove",this.frozenColumn._wrapMoveEvent,!0),document.body.removeEventListener("mouseup",this.frozenColumn._wrapUpEvent,!0)}},verticalScroll:{pos:null,_wrapMoveEvent:null,_wrapUpEvent:null,_areaDownEvent:function(b){var c,d=this.rowTop,e=this.viewModel.getOption("vScrollDegree")||this.viewModel.getOption("rowNum");d+=(b<this.$scrollYHandle.position().top?-1:1)*e,c=20*d,this.viewModel.setOption("scrollTop",c),a("body").addClass("noselect")},areaDownEvent:function(a){var b=a.offsetY||a.pageY-this.$scrollYArea.offset().top;this.verticalScroll._areaDownEvent.call(this,b)},_handleDownEvent:function(a){var b=this.$scrollYHandle.position().top;this.verticalScroll.pos={top:b,currentY:a}},handleDownEvent:function(a){var c=this;if(a.preventDefault(),a.stopPropagation(),this.isMobile){if(!a.originalEvent.touches)return!1;a=a.originalEvent.touches[0]}this.verticalScroll._handleDownEvent.call(this,a.clientY),this.verticalScroll._wrapMoveEvent=function(a){c.verticalScroll.moveEvent.call(this,a)},this.verticalScroll._wrapUpEvent=function(a){c.verticalScroll.upEvent.call(this,a)},this.verticalScroll._wrapMoveEvent=b.bind(this.verticalScroll._wrapMoveEvent,this),this.verticalScroll._wrapUpEvent=b.bind(this.verticalScroll._wrapUpEvent,this),this.isMobile?(document.body.addEventListener("touchmove",this.verticalScroll._wrapMoveEvent,!0),document.body.addEventListener("touchend",this.verticalScroll._wrapUpEvent,!0)):(document.body.addEventListener("mousemove",this.verticalScroll._wrapMoveEvent,!0),document.body.addEventListener("mouseup",this.verticalScroll._wrapUpEvent,!0))},_moveEvent:function(a){if(this.verticalScroll.pos){var b=this.$scrollYArea.height()-this.$scrollYHandle.height(),c=parseInt(this.verticalScroll.pos.top+a-this.verticalScroll.pos.currentY,10),d=this.wholeTblHeight-20*this.viewModel.getOption("rowNum"),e=c*d/b;this.viewModel.setOption("scrollTop",e)}},moveEvent:function(a){this.isMobile&&a.preventDefault(),this.verticalScroll._moveEvent.call(this,this.isMobile?a.touches[0].clientY:a.clientY)},_upEvent:function(){this.verticalScroll.pos=null},upEvent:function(){this.verticalScroll._upEvent.call(this),this.isMobile?(document.body.removeEventListener("touchmove",this.verticalScroll._wrapMoveEvent,!0),document.body.removeEventListener("touchend",this.verticalScroll._wrapUpEvent,!0)):(document.body.removeEventListener("mousemove",this.verticalScroll._wrapMoveEvent,!0),document.body.removeEventListener("mouseup",this.verticalScroll._wrapUpEvent,!0))}},horizontalScroll:{pos:null,_wrapMoveEvent:null,_wrapUpEvent:null,_areaDownEvent:function(a){var b=this.$scrollXHandle.position().left,c=this.$scrollXArea.width()-this.$scrollXHandle.width(),d=b*(this.wholeTblWidth-this.tableWidth)/c,e=this.viewModel.getFrozenArea();d+=(b>a?-1:1)*(this.tableWidth-e),this.viewModel.setOption("scrollLeft",d)},areaDownEvent:function(b){var c=b.offsetX||b.pageX-a(b.target).offset().left;this.horizontalScroll._areaDownEvent.call(this,c)},_handleDownEvent:function(a){this.horizontalScroll.pos={left:this.$scrollXHandle.position().left,currentX:a}},handleDownEvent:function(a){var c=this;if(a.preventDefault(),a.stopPropagation(),this.isMobile){if(!a.originalEvent.touches)return!1;a=a.originalEvent.touches[0]}this.horizontalScroll._handleDownEvent.call(this,a.clientX),this.horizontalScroll._wrapMoveEvent=function(a){c.horizontalScroll.moveEvent.call(this,a)},this.horizontalScroll._wrapUpEvent=function(a){c.horizontalScroll.upEvent.call(this,a)},this.horizontalScroll._wrapMoveEvent=b.bind(this.horizontalScroll._wrapMoveEvent,this),this.horizontalScroll._wrapUpEvent=b.bind(this.horizontalScroll._wrapUpEvent,this),this.isMobile?(document.body.addEventListener("touchmove",this.horizontalScroll._wrapMoveEvent,!0),document.body.addEventListener("touchend",this.horizontalScroll._wrapUpEvent,!0)):(document.body.addEventListener("mousemove",this.horizontalScroll._wrapMoveEvent,!0),document.body.addEventListener("mouseup",this.horizontalScroll._wrapUpEvent,!0))},_moveEvent:function(a){if(this.horizontalScroll.pos){var b=this.$scrollXArea.width()-this.$scrollXHandle.width(),c=parseInt(this.horizontalScroll.pos.left+a-this.horizontalScroll.pos.currentX,10),d=this.wholeTblWidth-this.tableWidth,e=c*d/b;this.viewModel.setOption("scrollLeft",e)}},moveEvent:function(a){this.isMobile&&a.preventDefault(),this.horizontalScroll._moveEvent.call(this,this.isMobile?a.touches[0].clientX:a.clientX)},_upEvent:function(){this.horizontalScroll.pos=null},upEvent:function(){this.horizontalScroll._upEvent.call(this),this.isMobile?(document.body.removeEventListener("touchmove",this.horizontalScroll._wrapMoveEvent,!0),document.body.removeEventListener("touchend",this.horizontalScroll._wrapUpEvent,!0)):(document.body.removeEventListener("mousemove",this.horizontalScroll._wrapMoveEvent,!0),document.body.removeEventListener("mouseup",this.horizontalScroll._wrapUpEvent,!0))}},scrollByWheel:{wheelEvent:function(a){var b=a.originalEvent||a,c=0,d=0;"TD"===a.target.tagName&&("detail"in b&&(d=b.detail),"wheelDelta"in b&&(d=-1*b.wheelDelta),"wheelDeltaY"in b&&(d=-1*b.wheelDeltaY),"wheelDeltaX"in b&&(c=-1*b.wheelDeltaX),Math.abs(d)<40?d*=20:d/=2,this.scrollBy(c,d),a.preventDefault(),a.stopPropagation())}},clickCell:{clickEvent:function(b){var c=a(b.target).closest("tr").index()+this.rowTop,d=a(b.target).closest("td").index(),e=this.viewModel.getOption("frozenColumn"),f=e>d?d:d+this.startCol-e,g=this.viewModel.getMeta([c,f],"displayType");this.setFocusedCell(c,f,"TD"===b.target.tagName),t[g][b.type]&&t[g][b.type](b,this,c,f)}},onModelChange:function(a,c){var d=a.collection.indexOf(a),e=this.gridEventMatch.change||[],f=c.eventObj||{type:"change"},g="",h={};h.rowIndex=d,c.status&&b.extend(h,c.status),b.each(a.changed,function(b,i){h.colID=i,g=this.viewModel.getMeta([d,i],"displayType"),!c.status&&t[g].completedOptions&&(h=t[g].completedOptions(this,h,d,i,b,a)),this.fireGridEvent(e,a.cid,i,f,h,!0),c.noDraw||this.drawCell(d,i)},this)},onModelAddRemove:function(a,b,c){var d=b.indexOf(a);-1===d&&(d=c.index||0),this.drawPartial(d)},onReset:function(){this.$wrapper_div&&(this.viewModel.setOption("scrollLeft",0,{silent:!0}),this.viewModel.setOption("scrollTop",0,{silent:!0}),this.createTbody(),this.setResize())},drawPartial:function(a){this.wholeTblHeight=this.getWholeTblHeight(),this.viewModel.getDataLength()<this.viewModel.getOption("rowNum")?this.setResize():0!==this.rowTop&&this.rowTop>a||this.getRowLength()-this.viewModel.getOption("rowNum")<a?this.viewModel.setOption("scrollTop",20*a):this.drawTbody(a)},drawWhole:function(a){a instanceof y&&this.onReset()},drawMetaByPos:function(a){var c,d;if(a.hasChanged("width")||a.hasChanged("flex")||a.hasChanged("hidden"))return void("column"===a.type&&(a.hasChanged("width")&&a.set("flex",null,{silent:!0}),this.viewModel.updateVisibleCol(),this.setResize(),a.hasChanged("width")&&this.trigger("adjustColumn",{type:"adjustColumn"},{colID:a.colID,beforeWidth:a.previous("width")?a.previousAttributes().width.value:this.viewModel.metaDefaultObject.width,width:a.get("width").value})));if(a.hasChanged("collapsed")&&"row"===a.type&&(d=a.get("id").split(","),d[0]=this.viewModel.getMetaIndex(d[0]),this.viewModel.toggleGroup(d[0])),"table"===a.type)this.drawTbody();else if("row"===a.type||b(a.changed).keys().length>1)d=this.viewModel.getMetaIndex(a.id),this.drawTbody(d,d);else if("column"===a.type)for(d=a.get("id"),c=this.rowTop;c<this.rowTop+this.viewModel.getOption("rowNum");c++)this.drawCell(c,d);else d=a.get("id").split(","),d[0]=this.viewModel.getMetaIndex(d[0]),this.drawCell(d[0],d[1])},drawByScroll:function(){if(this.$el){var c,d,e,f,g,h,i,j,k,l,m,n,o,p=this.viewModel.getOption("scrollLeft"),q=this.viewModel.getOption("scrollTop"),r=this.viewModel.getOption("frozenColumn"),s=this.wholeTblWidth-this.tableWidth,t=this.wholeTblHeight-20*this.viewModel.getOption("rowNum"),u=this.$(".frozenHandle"),v=this.$("colgroup col"),w=this.viewModel.getFrozenArea(),x=this.viewModel.getVisibleCol(),y=0,z=-1,A=-1,B=!1;for(p>s&&(p=s),0>p&&(p=0),p=parseInt(p,10),this.viewModel.setOption("scrollLeft",p,{silent:!0}),u.css("left",w).toggleClass("hide",!w).toggleClass("show",!!w),this.$scrollXArea.css("left",w),j=r;j<x.length;j++)if(k=this.viewModel.getMeta(["*",j],"width"),y+=k,-1===z)y-k/2>p&&(z=A=j,y=k);else if(A=j,y>this.$scrollXArea.width())break;if(this.startCol!==z||this.endCol!==A){for(this.startCol=z,this.endCol=A,j=v.length;A-z+r>=j;j++)this.$("colgroup").append("<col>"),this.$("thead tr").append("<th class='gGrid-headerLabel' scope='col'><div class='gGrid-headerLabelWrap'><div class='gGrid-headerLabelText'></th>"),this.$("tbody tr").append("<td>");v=this.$("colgroup col"),this.$("table").width(y+w),b(v).each(function(b,c){var d=r>c?c:c+z-r,e=A>=d?this.viewModel.getMeta(["*",d],"width"):0;a(b).width(e),0===e&&(o=this.viewModel.getMeta(["*",d],"innerCellView",{noncomputed:!0}),o&&(o.remove(),this.viewModel.removeMeta(["*",d],"innerCellView",{silent:!0})),n=a(this.getHeaderCell(0,c)),n.off("mouseenter").off("mouseleave"),n.children(0).html(""))},this),B=!0}q>t&&(q=t),0>q&&(q=0),q=parseInt(q,10),this.viewModel.setOption("scrollTop",q,{silent:!0}),m=parseInt(q/20,10),this.rowTop!==m&&(this.rowTop=m,B=!0),B&&(this.drawHeader(),this.drawTbody(),this.setFocusedCell()),e=this.$scrollYArea.height(),f=this.$("tbody tr").length*e/this.viewModel.getDataLength(),f=this.scrollYHandleMinHeight>f?this.scrollYHandleMinHeight:f,g=this.$scrollXArea.width(),h=g*this.tableWidth/this.wholeTblWidth,h=this.scrollXHandleMinWidth>h?this.scrollXHandleMinWidth:h,c=e-f,l=parseInt(q*c/t+.5,10),this.$scrollYHandle.css("top",l+"px"),this.$scrollYHandle.height(f),this.$scrollYArea.css(f>=e?{opacity:0,"-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)"}:{opacity:1,"-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)"}),d=g-h,i=d*p/(this.wholeTblWidth-this.tableWidth),this.$scrollXHandle.css("left",i+"px"),this.$scrollXHandle.width(h),this.$scrollXArea.css(h>=g?{opacity:0,"-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)"}:{opacity:1,"-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)"})}},onOptionChange:function(a){a.hasChanged("colOrder")&&(this.viewModel.updateVisibleCol(),this.setResize()),a.hasChanged("frozenColumn")&&(this.wholeTblWidth=this.getWholeTblWidth(),this.viewModel.setOption("scrollLeft",0,{silent:!0}),this.drawByScroll(),this.trigger("frozenColumn",{type:"frozenColumn"},{oldFrozenColumn:a.previous("frozenColumn")?a.previous("frozenColumn"):this.viewModel.optionDefaultObject.frozenColumn,frozenColumn:a.changedAttributes().frozenColumn})),(a.hasChanged("scrollTop")||a.hasChanged("scrollLeft")&&!a.hasChanged("frozenColumn"))&&this.drawByScroll(),a.hasChanged("width")&&(this.$el.css("width",a.get("width")),this.setResize())},getHeaderCell:function(a,b){return this.$("table thead tr:nth-child("+(a+1)+") th:nth-child("+(b+1)+")")[0]},getTbodyCell:function(a,b){return this.$("table tbody tr:nth-child("+(a+1)+") td:nth-child("+(b+1)+")")[0]},getWholeTblWidth:function(){var a,b,c=0,d=-1,e=this.viewModel.getOption("frozenColumn"),f=this.viewModel.getFrozenArea(),g=this.viewModel.getVisibleCol();for(b=g.length-1;b>=e;b--){if(a=this.viewModel.getMeta(["*",b],"width"),b!==g.length-1&&c+a>this.tableWidth-f){d=b;break}c+=a}for(c=0,b=e;d>=b;b++)c+=this.viewModel.getMeta(["*",b],"width");return c+this.tableWidth},getWholeTblHeight:function(){return 20*this.viewModel.getDataLength()},drawHeader:function(){for(var a=this.viewModel.getOption("frozenColumn"),b=0;a>b;b++)this.drawHeaderCell(0,b);for(b=this.startCol;b<=this.endCol;b++)this.drawHeaderCell(0,b)},drawTbody:function(a,b){var c,d=this.viewModel.getOption("frozenColumn");for(a=a||this.rowTop,arguments.length<2&&(b=this.rowTop+this.viewModel.getOption("rowNum")-1),c=a;b>=c;c++){for(var e=0;d>e;e++)this.drawCell(c,e);for(e=this.startCol;e<=this.endCol;e++)this.drawCell(c,e)}},drawHeaderCell:function(c,d){var e,f,g=this.viewModel.getColIndex(d),h=this.viewModel.getOption("colOrder"),i=this.viewModel.getOption("frozenColumn"),j=this.viewModel.getVisibleCol(),k=this.viewModel.getColID(d),l=i>g?g:g-this.startCol+i,m=!1,n=this.getHeaderCell(0,l),o=a(n),p=this.viewModel.getMeta(["*",d],"headerLabel"),q=a("<div class='gGrid-headerLabelText'></div>"),r=a("<i class='w5-grid-sort'></i>"),s=this.viewModel.getMeta(["*",d],"headerDisplayType",{noncomputed:!0});n&&(s?(f=this,e=this.viewModel.getMeta(["*",d],"innerCellView",{noncomputed:!0}),e&&e.remove(),e=new v[s](q,f,p,[c,d]),this.viewModel.setMeta(["*",d],"innerCellView",e,{silent:!0}),q.append(e)):q.append(p),this.viewModel.getMeta(["*",d],"sortable")!==!1&&q.append(r),o.off("mouseenter").off("mouseleave"),this.isBasic||(this.filter_menu_html?b.indexOf(this.viewModel.collection.filterInfo.column_list,k)>-1?(m=!0,o.addClass("filter-column")):(m=!1,o.removeClass("filter-column")):this.filter_menu_html={}),o.attr("abbr",p).children(0).html("").append(q).append(this.getColMenu(g,l,m)).append(this.getAdjustColHandle(g)));var t=b(h).indexOf(j[d]),u=h[t-1];0===t||b(j).indexOf(u)>=0?o.find(".display-left .w5-grid-column-show").addClass("hide"):o.find(".display-left .w5-grid-column-show").removeClass("hide");var w=this.collection.sortInfo.column||[],x=this.collection.sortInfo.direction||[],y=["state-none","state-asc","state-desc"],z=["Sort None","Sort Ascending","Sort Descending"],A=b.indexOf(w,k),B=-1===A?0:"asc"===(x[A]||"asc")?1:2;o.find(".w5-grid-sort").addClass(y[B]).removeClass(y[(B+1)%3]).removeClass(y[(B+2)%3]).text(z[B])},drawCell:function(c,d){var e,f,g,h,i,j,k,l,m,n=this.viewModel.getColIndex(d),o=this.viewModel.getOption("frozenColumn"),p=o>n||this.startCol<=n&&n<=this.endCol,q=this.rowTop<=c&&c<this.rowTop+this.viewModel.getOption("rowNum"),r=o>n?n:n-this.startCol+o;p&&q&&(e=a(this.getTbodyCell(c-this.rowTop,r)),e.length>0&&(c<this.viewModel.getDataLength()?(f=this.viewModel.getData([c,d]),g=t[this.viewModel.getMeta([c,d],"displayType")],j=this.viewModel.getMeta([c,d],"nodeFormatter"),j&&b.isFunction(j)&&(k=!0),k&&j.destroy&&b.isFunction(j.destroy)&&j.destroy.call(this.view,e,f,this.viewModel.collection.at(c),c,this.viewModel.getColID(n)),h=g.getContent(this,f,c,n),e.html("").append(h),b.isObject(h)&&h.data("afterProcess")&&h.data("afterProcess").run(),k&&(i=e.get(0),i=i.querySelector(":first-child"),i&&j.call(this.view,e,i,f,this.viewModel.collection.at(c),c,this.viewModel.getColID(n))),l=this.viewModel.getMeta([c,d],"style"),m=this.viewModel.getMeta([c,d],"className")||""):(e.html(""),l=null,m=""),e[0].style.cssText="",l&&e.css(l),e.attr("class",m)))},getAdjustColHandle:function(){var c=this,d={$adjustHandle:a("<i class='adjustCol-handle'>Adjust this Column</i>"),$adjustCol_start:c.$(".adjustCol-start"),$adjustCol_move:c.$(".adjustCol-move"),targetCol:0,targetColW:0,targetColLeft:0,draggingX:0,colDragInfo:{},downEvent:function(b){var c=a(b.target).parent().closest("th");this.targetCol=c.index(),this.targetColW=c.width(),this.targetColLeft=c.position().left,this.colDragInfo={posX:b.clientX,startX:this.targetColLeft+this.targetColW},this.$adjustCol_start.css("left",this.colDragInfo.startX),this.$adjustCol_start.removeClass("hide").addClass("show"),this.$adjustCol_move.css("left",this.colDragInfo.startX),this.$adjustCol_move.removeClass("hide").addClass("show"),document.body.addEventListener("mousemove",this.moveEvent,!0),document.body.addEventListener("mouseup",this.upEvent,!0),b.stopPropagation()},moveEvent:function(b){this.draggingX=b.clientX-this.colDragInfo.posX,this.$adjustCol_move.css("left",this.colDragInfo.startX+this.draggingX-this.$adjustCol_move.width()),a("body").addClass("sizingH")},upEvent:function(){var b,d;this.targetColW+this.draggingX>0&&(d=c.viewModel.getOption("frozenColumn"),this.targetCol>=d&&(this.targetCol+=c.startCol-d),b=c.viewModel.getMeta(["*",this.targetCol],"width"),c.viewModel.setMeta(["*",this.targetCol],"width",b+this.draggingX)),this.$adjustCol_start.removeClass("show").addClass("hide"),this.$adjustCol_move.removeClass("show").addClass("hide"),a("body").removeClass("sizingH"),document.body.removeEventListener("mousemove",this.moveEvent,!0),document.body.removeEventListener("mouseup",this.upEvent,!0)}};return b(d).bindAll("downEvent","moveEvent","upEvent"),d.$adjustHandle.on("mousedown",d.downEvent),d.$adjustHandle},colLeftMenu:b.template("<div class='gGrid-colMenu display-left'><button type='button' class='w5-grid-column-show'>Show hide column</button></div>"),colRightMenu:b.template("<div class='gGrid-colMenu display-right hide'><button type='button' class='w5-grid-colMenu-icon'>Open this column menu</button><ul role='menu' class='w5-dropdown-menu form-none'><li><a href='#' role='menuitem' class='w5-dropdown-menu-label column-hide'>Column Hide</a></li><li><a href='#' role='menuitem' aria-disabled='false' class='w5-dropdown-menu-label frozen-column'>Set Frozen Column</a></li></ul></div>"),getColMenu:function(c,d,e){var f=this,g=f.viewModel.getColID(c),h=a(document.createDocumentFragment()),i=a(this.colLeftMenu()),j=a(this.colRightMenu()),k=j.find(".w5-grid-colMenu-icon"),l=f.viewModel.getOption("colOrder"),m=f.viewModel.getVisibleCol(),n=f.viewModel.getOption("frozenColumn"),o=f.viewModel.getOption("scrollLeft"),p={_showCol:function(){var a,d=b(l).indexOf(m[c])-1,e=b(l).indexOf(m[c-1]);if(!(c>=n))throw new Error("Section of the column to a frozen column can not be show. \nFirst, turn off the frozen column.");for(a=d;a>=e&&a>=0;a--)f.viewModel.setMeta(["*",l[a]],"hidden",!1);f.viewModel.updateVisibleCol()},showCol:function(a){this._showCol(a.target)}};b(p).bindAll("showCol"),i.find(".w5-grid-column-show").on("click",p.showCol),h.append(i);var q={_openColMenu:function(b){var c,d=0,e=a(b).closest("th"),g=e.index();for(f.$("thead th .display-right").removeClass("open"),f.$("thead th .display-right .w5-grid-colMenu-icon").removeClass("on"),j.addClass("open"),a(b).addClass("on"),c=0;g>=c;c++)d+=f.$("thead th").eq(c).width();d>f.$wrapper_div.width()-e.find(".display-right .w5-dropdown-menu").width()&&e.find(".display-right .w5-dropdown-menu").css({left:"auto",right:"0px"})},openColMenu:function(a){this._openColMenu(a)},_closeColMenu:function(){j.removeClass("open"),k.removeClass("on")},closeColMenu:function(){this._closeColMenu()},_hideCol:function(){var a=f.viewModel.getVisibleCol().length;if(1===a)throw new Error("W5 Grid is must have a column.");if(!(c>=n))throw new Error("Section of the column to a frozen column can not be hidden.\nFirst, turn off the frozen column.");f.viewModel.setMeta(["*",c],"hidden",!0),f.viewModel.updateVisibleCol()},hideCol:function(a){this._hideCol(a.target),a.preventDefault()},_frozenCol:function(){f.viewModel.setOption("frozenColumn",c+1)},frozenCol:function(a){this._frozenCol(a),a.preventDefault()},clearNextFormEls:function(a){a.nextAll().remove()},changeDataCondition:function(b){var c,d=a(b.target),e=d.parent(),g=b.target.value;("textContains"===g||"textDoesNotContain"===g||"textIsExactly"===g||"cellIsEmpty"===g)&&(this.clearNextFormEls(d),d.removeClass("select-sm").addClass("select-lg"),c=a(f.filterTemplate_input()),c.removeClass("input-xs").addClass("input-sm"),e.append(c)),("dateIs"===g||"dateIsBefore"===g||"dateIsAfter"===g)&&(this.clearNextFormEls(d),d.removeClass("select-sm").addClass("select-lg"),c=a(f.filterTemplate_date()),c.on("change",this.changeDateCondition),e.append(c)),("greaterThan"===g||"lessThan"===g||"isEqualTo"===g||"isNotEqualTo"===g||"isBetween"===g||"isNotBetween"===g)&&(this.clearNextFormEls(d),d.removeClass("select-sm").addClass("select-lg"),"isBetween"===g||"isNotBetween"===g?(e.append(a(f.filterTemplate_input())),e.append(a(f.filterTemplate_input()))):e.append(a(f.filterTemplate_input()).removeClass("select-xs").addClass("select-sm")))},changeDateCondition:function(b){var c=a(b.target),d=a(f.filterTemplate_input()),e=c.parent(),g=b.target.value;"theDate"===g?(c.prev().removeClass("select-lg").addClass("select-sm"),c.removeClass("select-lg").addClass("select-xs"),d.attr("placeholder","MM-DD-YYYY"),e.append(d)):(this.clearNextFormEls(c),c.removeClass("select-xs").addClass("select-lg"))},addFilterMenu:function(b){var c=a(b.target).closest("li"),d=a(f.filterTemplate());d.find(".condition-remove-btn").on("click",this.removeFilterMenu),c.before(d),c.siblings().length>4&&d.addClass("line-dashed"),this.$addConditionBtn.index()>2&&!this.$addConditionBtn.hasClass("line-dashed")&&this.$addConditionBtn.addClass("line-dashed"),d.find(".w5-grid-form-select").eq(0).on("change",this.changeDataCondition)},removeFilterMenu:function(b){var c=a(b.target).closest("li"),d=c.siblings();c.remove(),d.eq(2).hasClass("line-dashed")&&d.eq(2).removeClass("line-dashed"),this.$addConditionBtn.index()>3&&this.$addConditionBtn.addClass("line-dashed")},applyFilter:function(){var a,c,d=j.find(".w5-grid-form .form-group"),e=d.length,h=d.closest("li"),i=f.viewModel.collection.filterInfo.column_list,k={},l=[];if(k[g]={},0===e)k[g]=null,f.filter_menu_html[g]=null,1===i.length&&b.indexOf(i,g)>-1?f.viewModel.filter():f.viewModel.filter(k);else{for(c=0;e>c;c++)a=d.eq(c).children(),"isBetween"===a.eq(0).val()||"isNotBetween"===a.eq(0).val()?(l.push(a.eq(1).val(),a.eq(2).val()),k[g][a.eq(0).val()]=l):k[g][a.eq(0).val()]="theDate"===a.eq(1).val()?a.eq(2).val():a.eq(1).val();f.filter_menu_html[g]=h.clone(),f.viewModel.filter(k)}},displayFilterCondition:function(){var a;f.filter_menu_html[g]&&(f.filter_menu_html[g].find(".condition-remove-btn").on("click",this.removeFilterMenu),a=f.filter_menu_html[g].find(".w5-grid-form-select").length,f.filter_menu_html[g].eq(0).on("change",this.changeDataCondition),2===a&&f.filter_menu_html[g].eq(1).on("change",this.changeDateCondition),this.$filterMenu.append(f.filter_menu_html[g]))}};return b(q).bindAll("openColMenu","closeColMenu","hideCol","frozenCol","clearNextFormEls","changeDataCondition","changeDateCondition","addFilterMenu","removeFilterMenu","applyFilter","displayFilterCondition"),j.find(".w5-grid-colMenu-icon").on("click",function(){a(this).hasClass("on")?q.closeColMenu(a(this)):q.openColMenu(a(this))}),j.find(".w5-dropdown-menu li").find(".column-hide").on("click",q.hideCol),j.find(".w5-dropdown-menu li").find(".frozen-column").on("click",q.frozenCol),f.$("thead tr:first-child th").eq(d).on("mouseenter",function(){a(this).find(".display-right").removeClass("hide")}),f.$("thead tr:first-child th").eq(d).on("mouseleave",function(){j.removeClass("open").addClass("hide"),q.closeColMenu()}),"hidden"!==this.viewModel.getMeta(["*",c],"colMenu")&&((0!==o||c+1===n)&&(j.find(".frozen-column").attr("aria-disabled",!0).addClass("disabled"),j.find(".frozen-column").off("click",q.frozenCol)),this.isBasic||(q.$filterMenu=a(document.createDocumentFragment()),q.$filterTemp=a(this.filterTemplate()),q.$addConditionBtn=a(this.filterTemplate_addCondition()),q.$filterBtnSet=a(this.filterTemplate_btnSet()),q.$addConditionBtn.find(".condition-add-btn").on("click",q.addFilterMenu),q.$filterBtnSet.find(".btn-normal.color-blue").on("click",q.applyFilter),q.$filterBtnSet.find(".btn-normal.color-gray").on("click",q.closeColMenu),e?(q.displayFilterCondition(),q.$filterMenu.append(q.$addConditionBtn.addClass("line-dashed")).append(q.$filterBtnSet)):q.$filterMenu.append(q.$addConditionBtn).append(q.$filterBtnSet),j.find(".w5-dropdown-menu").removeClass("form-none").append(q.$filterMenu)),h.append(j)),h},setFlex:function(){var a=this.tableWidth,c=0,d=[],e=0;if(b(this.viewModel.getVisibleCol()).each(function(c,f){var g=this.viewModel.getMeta(["*",f],"flex");b.isNumber(g)?(d.push({col:f,flex:g,diff:0}),e+=g):a-=this.viewModel.getMeta(["*",f],"width")},this),0!==d.length){for(var f=0;f<d.length;f++)d[f].width=parseInt(d[f].flex*a/e,10),c+=d[f].width;for(a-=c,f=0;a>f;f++){for(var g=1/0,h=-1,i=0;i<d.length;i++){var j=d[i].diff+1,k=d[i].width;g>j*(c/k)&&(g=j*(c/k),h=i)}d[h].diff+=1}for(f=0;f<d.length;f++){var l=["*",d[f].col];l.silent=!0,this.viewModel.setMeta(l,"width",d[f].width+d[f].diff,{silent:!0})}}},setResize:function(){this.tableWidth=this.$wrapper_div.width(),this.setFlex(),this.wholeTblWidth=this.getWholeTblWidth(),this.wholeTblHeight=this.getWholeTblHeight(),this.startCol=this.endCol=-1,this.createTbody(),this.drawByScroll()},checkResize:function(){var a=this.$el.width();this.wrapper_width!==a&&(this.wrapper_width=a,this.setResize())},refresh:function(){return this.setResize(),this.trigger("refresh",{type:"refresh"}),this},scrollTo:function(a,b){return this.viewModel.setOption({scrollLeft:a||0,scrollTop:b||0}),this},scrollBy:function(a,b){return this.viewModel.setOption({scrollLeft:this.viewModel.getOption("scrollLeft")+(a||0),scrollTop:this.viewModel.getOption("scrollTop")+(b||0)}),this},moveColumn:function(a,c){var d,e,f=this.viewModel.getOption("colOrder"),g=f[a],h=f[c],i=b(this.viewModel.getVisibleCol()),j=[i.indexOf(f[a]),i.indexOf(f[c])],k=this.viewModel.getOption("frozenColumn")-1,l=null;return f=f.slice(),d=f.splice(a,1)[0],f.splice(c,0,d),this.focusedCell&&(j[0]===this.focusedCell.colIndex?l=j[1]:j[1]===this.focusedCell.colIndex&&(l=j[0]>j[1]?j[1]+1:j[1]-1),e={oldColID:this.viewModel.getColID(this.focusedCell.colIndex)}),j[0]<=k&&j[1]>k?this.viewModel.setOption("frozenColumn",k,{silent:!0}):j[0]>k&&j[1]<=k&&this.viewModel.setOption("frozenColumn",k+2,{silent:!0}),this.viewModel.setOption("colOrder",f),l&&this.setFocusedCell(this.focusedCell.rowIndex,l,null,e),this.trigger("moveColumn",{type:"moveColumn"},{fromColumnIndex:a,toColumnIndex:c,fromColumnID:g,toColumnID:h}),this},addRow:function(){return this.viewModel.addRow.apply(this.viewModel,arguments),this},removeRow:function(a,b){return this.viewModel.removeRow(a,b),this},removedRow:function(a){return this.viewModel.removedRow(a)},reset:function(a){return a=a||[],this.viewModel.table.clear({silent:!0}),this.viewModel.row.reset([],{silent:!0}),this.viewModel.column.reset([],{silent:!0}),this.viewModel.cell.reset([],{silent:!0}),b(this.viewModel.colModel).each(function(a,c){b.chain(a).each(function(a,b){"id"!==b&&this.viewModel.setMeta(["*",c],b,a,{inorder:!0,silent:!0})},this)},this),this.viewModel.collection.reset(a),this},sort:function(a,b,c){return this.viewModel.sort(a,b,c),this},getRowLength:function(){return this.viewModel.getDataLength()},getColLength:function(){return this.viewModel.getVisibleCol().length},_getColLength:function(){return this.viewModel.getOption("colOrder").length},getCollection:function(){return this.viewModel.collection},setColumnVisible:function(a,c){var d,e={inorder:!0};return b.isNumber(a)&&this.viewModel.setMeta(["*",a],"hidden",!c,e),b.isArray(a)&&(e.silent=!0,d=a.length-1,b(a).each(function(a,b){b===d&&delete e.silent,this.viewModel.setMeta(["*",a],"hidden",!c,e)},this)),this},getColumnVisibility:function(a){var c=this.viewModel.getOption("colOrder"),d=this.viewModel.getVisibleCol();return"hidden"===a?b(c).difference(d):d},_cell:function(a,b){return new g(this,[[a,this.viewModel.getColID(b,!0)]])},_row:function(a){return new g(this,[[a,"*"]])},_col:function(a){return new g(this,[["*",this.viewModel.getColID(a,!0)]])},cell:function(a,b){return new g(this,[[a,this.viewModel.getColID(b)]])},row:function(a){return new g(this,[[a,"*"]])},col:function(a){return new g(this,[["*",this.viewModel.getColID(a)]])},table:function(){return new g(this,[["*","*"]])},option:function(){return this.viewModel.option},fetch:function(){return this.viewModel.fetch.apply(this.viewModel,arguments),this},getCUData:function(a){return this.viewModel.getCUData(a)},syncData:function(a){return this.viewModel.syncData(a),this},getGridData:function(){return this.viewModel.getGridData()},setDefaults:function(a){return this.viewModel.setDefaults(a),this},getDefaults:function(){return this.viewModel.getDefaults()},setPseudo:function(a,b){return b&&(a.pseudo=b),a},pushElems:function(a,b,c,d,e,f,g){var h,i;if(!a||"*"===b&&a===d||"*"!==b&&"cell"===a)for(h=0;c>h;h++)"col"===d?i=this.viewModel.getColID(h):(0===h&&(i=b),b=h),e[b+"_"+i]||(e[b+"_"+i]=1,f.push(this.setPseudo([b,i],g)))},getChildren:function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q={},r=[];for(g=0;g<a.length;g++)if(h=a[g][0],i=a[g][1],"*"===i&&this.pushElems(c,h,this.viewModel.colModel.length,"col",q,r,e),"*"===h&&this.pushElems(c,i,this.collection.length,"row",q,r,e),"*"===h&&"*"===i&&(!c||"cell"===c))for(f=0;f<this.collection.length;f++)this.pushElems(!1,f,this.viewModel.colModel.length,"col",q,r,e);if(d){if(j=/\[([\w]+)(?:([\~\^\$\|\=]+)?\'(.+)\')?\]/g.exec(d),n=[],!j)throw new Error("Attribute value of selector must be wrapped single quotation marks.");for(k=j[1],l=j[2],m=j[3],f=0;f<r.length;f++)switch(o="data"===k?this.viewModel.getData(r[f]):this.viewModel.getMeta(r[f],k),l){case"=":String(o)===m&&n.push(r[f]);break;case"~=":"data"!==k?(p=o.match(/\w+/g),-1!==b.indexOf(p,m)&&n.push(r[f])):-1!==o.indexOf(m)&&n.push(r[f]);break;default:b.isEmpty(o)&&"data"===k&&b.isUndefined(m)||n.push(r[f])}r=n}if(e&&("row"===e||"col"===e)){for(q={},n=[],f=0;f<r.length;f++)"*"!==r[f][0]&&"*"!==r[f][1]&&("row"===r[f].pseudo?q[r[f][0]+"_*"]||(q[r[f][0]+"_*"]=!0,r[f][1]="*",n.push(r[f])):q["*_"+r[f][1]]||(q["*_"+r[f][1]]=!0,r[f][0]="*",n.push(r[f])));r=n}return r},select:function(a,c,d,e){var f,h,i,j,k,l,m=/row:checked/;for(e=e||{},a.search(m)>-1&&(k=this.viewModel.getCheckValue(),null!==k&&(a=a.replace(m,"col[id='"+this.viewModel.getColID(0)+"'] cell[data='"+k+"']:row"))),f=a.match(/\w+(\[([\S]+)([\~\^\$\|\=]+\'(.+)\')?\])?(\:\w+)?/g),c=c||[["*","*"]],d=d||[],i=0;i<f.length;i++){if(o[0].lastIndex=0,o[1].lastIndex=0,!o[0].test(f[i])){h=[];break}j=o[1].exec(f[i]),h=this.getChildren(c,j[1],j[2],j[3]),c=h}return Array.prototype.push.apply(d,h),e.union&&(l={},d=b.reduce(d,function(a,b){return l[b[0]+"_"+b[1]]||(l[b[0]+"_"+b[1]]=!0,a.push(b)),a},[])),new g(this,d)},addGridEvent:function(a,b){this.options.gridEvents=this.options.gridEvents||{},this.options.gridEvents[a]=b,this.setGridEvents()},removeGridEvent:function(a){this.options.gridEvents=this.options.gridEvents||{},delete this.options.gridEvents[a],this.setGridEvents()},triggerGridEvent:function(a,b,c){var d=this.gridEventMatch[b];c=c||{},c.rowIndex=a[0],c.colID=this.viewModel.getColID(a[1],!0),d&&this.fireGridEvent(d,this.viewModel.getDataCID(a[0]),a[1],{type:b},c,!0)},fireIndexChanged:function(a,b){b=b||{},a.oldColID=b.oldColID||this.viewModel.getColID(a.oldColIndex),a.colID=this.viewModel.getColID(a.colIndex),a.oldRowIndex!==a.rowIndex&&this.trigger("rowChanged",{type:"rowChanged"},a),a.oldColIndex!==a.colIndex&&this.trigger("colChanged",{type:"colChanged"},a)},clearFocusedCell:function(){var a=this;this.focusedCell&&(t.text.endEdit.call(t.text,{type:"blur"},a),this.focusedCell=null,this.setFocusedCell())},setFocusedCell:function(a,c,d,e){var f={oldRowIndex:-1,oldColIndex:-1,oldColID:"",rowIndex:-1,colIndex:-1,colID:""};if((b.isUndefined(d)||b.isNull(d))&&(d=!0),this.focusedCell&&(f.oldRowIndex=this.focusedCell.oldRowIndex>-1?this.focusedCell.oldRowIndex:this.focusedCell.rowIndex,f.oldColIndex=this.focusedCell.oldColIndex>-1?this.focusedCell.oldColIndex:this.focusedCell.colIndex),0===arguments.length){if(!this.focusedCell)return void this.$(".w5-grid-focused-cell").addClass("hide");a=this.focusedCell.rowIndex,c=this.focusedCell.colIndex}else this.focusedCell={rowIndex:a,colIndex:c};f.rowIndex=a,f.colIndex=c,this.$(".w5-grid-focused-cell").removeClass("hide");
var g=a-this.rowTop,h=this.viewModel.getOption("frozenColumn"),i=h>c?c:c-this.startCol+h,j=this.$("tbody tr").eq(g).find("td").eq(i);if(c>=h&&c<this.startCol&&(i=-1),0===j.length||0>g||0>i)return void this.$(".w5-grid-focused-cell").addClass("hide");var k=j.offset().top-this.$wrapper_div.offset().top,l=j.offset().left-this.$wrapper_div.offset().left,m=this.$scrollYArea.width(),n=this.$(".border-top").height(),o=j.outerWidth(),p=j.outerHeight();this.endCol===c&&(o-=m+n),this.$(".border-top").css({top:k,left:l,right:m,width:o}),this.$(".border-right").css({top:k,left:l+o,right:m,height:p+n}),this.$(".border-bottom").css({top:k+p,left:l,right:m,width:o}),this.$(".border-left").css({top:k,left:l,right:m,height:p}),!this.isMobile&&d&&this.$editBox.focus(),this.fireIndexChanged(f,e),this.focusedCell.oldRowIndex=a,this.focusedCell.oldColIndex=c},handleKeydown:function(a){this.keydownEvents[a.keyCode]&&this[this.keydownEvents[a.keyCode]].call(this,a)},moveUp:function(a,c){var d,e,f=c&&c.targetRow,g=c&&c.isForced;this.focusedCell&&(g||this.checkEditBox(a.target.className,!0))&&(d=this.focusedCell.rowIndex,e=this.focusedCell.colIndex,b.isNumber(f)||(f=d-1),f>-1&&(this.focusedCell={rowIndex:f,colIndex:e,oldRowIndex:d,oldColIndex:e},f<this.rowTop?this.viewModel.setOption("scrollTop",20*f):this.setFocusedCell(f,e)))},moveDown:function(a,c){var d,e,f=c&&c.targetRow,g=c&&c.isForced;this.focusedCell&&(g||this.checkEditBox(a.target.className,!0))&&(d=this.focusedCell.rowIndex,e=this.focusedCell.colIndex,b.isNumber(f)||(f=d+1),f<this.getRowLength()&&(this.focusedCell={rowIndex:f,colIndex:e,oldRowIndex:d,oldColIndex:e},f>=this.rowTop+this.viewModel.getOption("rowNum")?this.viewModel.setOption("scrollTop",20*f):this.setFocusedCell(f,e)))},moveLeft:function(a,c){var d,e,f,g=c&&c.targetCol,h=c&&c.isForced,i=this.viewModel.getOption("frozenColumn"),j=0;if(this.focusedCell&&(h||this.checkEditBox(a.target.className,!0))&&(d=this.focusedCell.rowIndex,e=this.focusedCell.colIndex,b.isNumber(g)||(g=e-1),g>=0))if(this.focusedCell={rowIndex:d,colIndex:g,oldRowIndex:d,oldColIndex:e},g<this.startCol)if(i>g)this.setFocusedCell(d,g);else{for(f=e;f>g-1;f--)j+=this.viewModel.getMeta(["*",f],"width");this.viewModel.setOption("scrollLeft",this.viewModel.getOption("scrollLeft")-j)}else this.setFocusedCell(d,g)},moveRight:function(a,c){var d,e,f,g=c&&c.targetCol,h=c&&c.isForced,i=this.viewModel.getOption("frozenColumn"),j=0,k=0;if(this.focusedCell&&(h||this.checkEditBox(a.target.className,!0))&&(d=this.focusedCell.rowIndex,e=this.focusedCell.colIndex,b.isNumber(g)||(g=e+1),g<=this.getColLength()-1))if(this.focusedCell={rowIndex:d,colIndex:g,oldRowIndex:d,oldColIndex:e},g>this.endCol-1)if(j=this.viewModel.getOption("scrollLeft"),this.endCol===this.getColLength()-1)j+=this.viewModel.getMeta(["*",this.endCol],"width"),this.wholeTblWidth-this.tableWidth>j?this.viewModel.setOption("scrollLeft",j):this.setFocusedCell(d,g);else{for(f=this.startCol;g>f;f++)k+=this.viewModel.getMeta(["*",f],"width");this.viewModel.setOption("scrollLeft",j+k)}else i&&i===g&&this.viewModel.setOption("scrollLeft",0),this.setFocusedCell(d,g)},checkEditBox:function(a,b){var c=!1;return"w5_grid_editbox"===a&&(b?this.$editBox.data("edit")||(c=!0):c=!0),c},focusWidget:function(b){var c,d,e,f;if(this.focusedCell){var g=this.focusedCell.rowIndex,h=this.focusedCell.colIndex,i=this;c=this.viewModel.getMeta([g,h],"displayType"),f=this.viewModel.getMeta([g,h],"readOnly"),"text"===c?this.$editBox.data("edit")?t.text.endEdit.call(t.text,b,i,{isForced:!0}):f||t.text.popupEditBox.call(t.text,i,g,h):f||(d=this.getTbodyCell(g-this.rowTop,h-this.startCol),d&&(e=this.viewModel.getMeta([g,h],"focusSelector"),"custom"===c&&e?a(d).find(e)[0].focus():(d.firstElementChild||d.children[0]).focus())),b.preventDefault()}},blurWidget:function(a){var b,c,d,e=this;this.focusedCell&&(b=this.focusedCell.rowIndex,c=this.focusedCell.colIndex,d=this.viewModel.getMeta([b,c],"displayType"),"text"===d&&t.text.endEdit.call(t.text,a,e,{isForced:!0}),this.setFocusedCell(b,c))},checkTabbableItem:function(a){return b.contains(this.tabbableElements,a.type)},getActivatePosition:function(c){var d,e,f,g,h=document.activeElement,i=!1,j=null,k=null;return this.checkEditBox(h.className)?this.focusedCell&&(j=this.focusedCell.colIndex,k=this.focusedCell.rowIndex):(d=a(h).closest("tr.gGrid-row>td"),this.checkTabbableItem(h)&&(g=[],f=d.get(0).childNodes,f=b.reduce(f,function(a,b){return"INPUT"===b.tagName&&a.push(b),a},g),c?f[0]!==h&&(i=!0):f[f.length-1]!==h&&(i=!0)),i||(e=d.closest("tr"),j=d.get(0).cellIndex+this.startCol,k=e.get(0).rowIndex-this.headNum+this.rowTop)),{row:k,col:j,runNative:i}},moveActionableItem:function(a){var b,c=a.shiftKey,d=this.getActivatePosition(c),e=this;if(!d.runNative&&null!==d.row){if(b=this.viewModel.getMeta([d.row,d.col],"displayType"),"text"===b&&this.$editBox.data("edit")&&t.text.endEdit.call(t.text,a,e,{isForced:!0}),c)if(0===d.col){if(!(d.row>0))return a.preventDefault(),!1;d.col=this.viewModel.getVisibleCol().length-1,d.col>=this.endCol&&(this.moveRight(a,{targetCol:d.col,isForced:!0}),this.moveUp(a,{isForced:!0}))}else this.moveLeft(a,{isForced:!0});else if(d.col===this.viewModel.getVisibleCol().length-1){if(!(d.row<this.getRowLength()-1))return a.preventDefault(),!1;d.col=0,d.col<=this.startCol&&(this.moveLeft(a,{targetCol:d.col,isForced:!0}),this.moveDown(a,{isForced:!0}))}else this.moveRight(a,{isForced:!0});this.focusWidget(a)}},jumpTo:function(a){a.keyCode===this.keySet.HOME?this.moveLeft(a,{targetCol:0,isForced:!0}):a.keyCode===this.keySet.END?this.moveRight(a,{targetCol:this.viewModel.getVisibleCol().length-1,isForced:!0}):a.keyCode===this.keySet.PageUP?this.moveUp(a,{targetRow:0,isForced:!0}):a.keyCode===this.keySet.PageDOWN&&this.moveDown(a,{targetRow:this.getRowLength()-1,isForced:!0})},delegateGridEvents:function(a){var c,d=[].slice.call(arguments,1);if("object"==typeof d[0])for(c in d[0])b.isString(d[0][c])&&(d[0][c]=this.options[d[0][c]]);else b.isString(d[1])&&(d[1]=this.options[d[1]]);-1!==a.search(/[l|L]isten/)&&d.unshift(d.pop()),p[a].apply(this,d)},on:function(a,b,c){this.delegateGridEvents("on",a,b,c)},off:function(a,b,c){this.delegateGridEvents("off",a,b,c)},once:function(a,b,c){this.delegateGridEvents("once",a,b,c)},listenTo:function(a,b,c){this.delegateGridEvents("listenTo",b,c,a)},stopListening:function(a,b,c){this.delegateGridEvents("stopListening",b,c,a)},listenToOnce:function(a,b,c){this.delegateGridEvents("listenToOnce",b,c,a)}};g.fn=g.prototype={constructor:g,init:function(a,b){this.grid=a,this.viewModel=a.viewModel,this.push.apply(this,b)},clone:function(a){this.grid=a},length:0,push:[].push,slice:[].slice,splice:[].splice,sort:[].sort},g.fn.init.prototype=g.fn,g.fn.clone.prototype=g.fn;var r={get:function(a){var c=[].slice.call(arguments,1),d=b(this).map(function(d){if("data"===a)return this.viewModel.getData.apply(this.viewModel,[d].concat(c));if("option"===a)return this.viewModel.getOption.apply(this.viewModel,c);var e=b.isString(c[0]),f=this.viewModel.getMeta.apply(this.viewModel,[d,a,e?c[1]:c[0]]);return e&&(f=f[c[0]]),f},this);return this.length>1?d:d[0]},set:function(a){var c=[].slice.call(arguments,1);return b(this).each(function(d){if("data"===a)this.viewModel.setData.apply(this.viewModel,[d].concat(c));else if("option"===a)this.viewModel.setOption.apply(this.viewModel,c);else{var e,f=b.isString(c[1]);f?(e=b.clone(this.viewModel.getMeta(d,a,{noncomputed:!0}))||{},e[c[0]]=c[1],this.viewModel.setMeta.apply(this.viewModel,[d,a,e,c[2]])):this.viewModel.setMeta.apply(this.viewModel,[d,a,c[0],c[1]])}},this),this},alter:function(a,c,d){var e=arguments;return b(this).each(function(f){if(2===e.length)this.viewModel.setMeta(f,a,c,{alter:!0});else{var g=b.clone(this.viewModel.getMeta(f,a))||{};g[c]=d,this.viewModel.setMeta(f,a,g,{alter:!0})}},this),this},has:function(a,b){if(1===arguments.length)return this.viewModel.hasMeta(this[0],a);var c=this.viewModel.getMeta(this[0],a)||{};return c.hasOwnProperty(b)},unset:function(a,c){var d=arguments;return b(this).each(function(e){if(2===d.length)this.viewModel.removeMeta(e,a);else{var f=b.clone(this.viewModel.getMeta(e,a))||{};delete f[c],this.viewModel.setMeta(e,a,f)}},this),this},addClass:function(a){var c,d;return d=""===a?[]:a.split(/\s/),b(this).each(function(a){c=this.viewModel.getMeta(a,"className",{noncomputed:!0}),c=""===c?[]:c.split(/\s/),b(d).each(function(a){c.push(a)}),this.viewModel.setMeta(a,"className",c.join(" "))},this),this},hasClass:function(a){var c=this.viewModel.getMeta(this[0],"className",{noncomputed:!0}),d=!1;return b(c.split(/\s+/)).each(function(b){b===a&&(d=!0)}),d},removeClass:function(a){var c=this.viewModel.getMeta(this[0],"className",{noncomputed:!0});return 0!==c.length&&b(this).each(function(d){this.viewModel.setMeta(d,"className",b(c.split(/\s+/)).difference(a.split(/\s+/)).join(" "))},this),this},toggleClass:function(a,c){var d,e=this.viewModel.getMeta(this[0],"className",{noncomputed:!0});return 1===arguments.length&&(b(e.split(/\s+/)).each(function(b,c){b===a&&(d=c)}),c=b.isUndefined(d)?!0:!1),c?this.addClass(a):this.removeClass(a),this},triggerGridEvent:function(a,c){return b(this).each(function(b){this.grid.triggerGridEvent(b,a,c)},this),this}},s={alterValue:function(a,b,c){b.firstChild.value=c},dblclick:function(a,b){b.focusWidget(a)},setOptions:function(a,b,c,d,e){return e?(a.index=b,a.value=c,a.label=d):(a.oldIndex=b,a.oldValue=c,a.oldLabel=d),a},getFormattedData:function(a,c,d,f,g){var h=f.viewModel.getMeta([c,d],"format")||"";return h=g&&g.format?g.format:h,b.isFunction(h)?h.call(f,a):e.formatter(a,h,f.viewModel.getMeta([c,d],"dataType"),{originalFormat:f.viewModel.getMeta([c,d],"originalFormat")||"",dayInWeek:f.viewModel.getOption("dayInWeek")||e.formatter.defaultDayInWeek,APM:f.viewModel.getOption("APM")||e.formatter.defaultAPM})}},t={};t.text=b.defaults({getContent:function(a,c,d,e){var f=a.viewModel.getMeta([d,e],"template")||"<%=data%>";return b.isString(f)&&(f=b.template(f)),f({data:this.getFormattedData(c,d,e,a)})},dblclick:function(b,c,d,e){var f=c.viewModel.getMeta([d,e],"readOnly");f||this.popupEditBox(c,d,e),a("body").addClass("noselect")},popupEditBox:function(c,e,f){var g=c.viewModel.getOption("frozenColumn"),h=g>f?f:f-c.startCol+g,i=a(c.getTbodyCell(e-c.rowTop,h)),j=c.viewModel.getData([e,f]);if(c.$editBox.text(j).css({width:"auto","min-width":i.outerWidth(),height:i.outerHeight(),top:i.offset().top-c.$wrapper_div.offset().top,left:i.offset().left-c.$wrapper_div.offset().left}).data({edit:!0,row:e,col:f,grid:c,dataType:b.isDate(j)?"date":b.isNumber(j)?"number":b.isBoolean(j)?"boolean":null}),c.$editBox.focus(),"undefined"!=typeof d.getSelection&&"undefined"!=typeof document.createRange){var k=document.createRange();k.selectNodeContents(c.$editBox[0]),k.collapse(!1);var l=d.getSelection();l.removeAllRanges(),l.addRange(k)}else if("undefined"!=typeof document.body.createTextRange){var m=document.body.createTextRange();m.moveToElementText(c.$editBox[0]),m.collapse(!1),m.select()}},endEdit:function(b,c,d){if(("blur"===b.type||"keydown"===b.type&&13===b.keyCode||d.isForced)&&c.$editBox.data("edit")){var f=c.$editBox.text(),g=c.$editBox.data("row"),h=c.$editBox.data("col"),i=c.$editBox.data("dataType");c.viewModel.setData([g,h],"date"===i?new Date(f):i?e.dataType[i](f):f),c.$editBox.text("").css("cssText",""),c.$editBox.removeData("edit")}a("body").removeClass("noselect")},completedOptions:function(a,b,c,d,e,f){return b.oldValue=f._previousAttributes[d],b.value=e,b}},s),b(t.text).bindAll("dblclick","popupEditBox","endEdit"),t.select=b.defaults({getContent:function(c,d,e,f){var g,h=c.viewModel.getMeta([e,f],"options"),i=-1;return g=a("<select>"+b(h).reduce(function(a,b,c){-1===i&&b.value===d&&(i=c);var e=i>-1&&b.value===d?" selected":"";return a+"<option "+e+">"+b.label+"</option>"},"")+"</select>"),g.prop("selectedIndex",i),-1===i?(g.data("status",this.setOptions({},i,void 0,void 0,!0)),g.data("afterProcess",{run:function(){g.prop("selectedIndex",-1),c.viewModel.setData([e,f],"",{silent:!0})}})):g.data("status",this.setOptions({},i,h[i].value,h[i].label,!0)),g.data("pos",{row:e,col:f}),g.on("change",function(b){var d=this.selectedIndex,e=a(this),f=e.data("pos"),g=e.data("status"),h=c.viewModel.getMeta([f.row,f.col],"options"),i=h[d]?h[d].value:void 0;g=t.select.setOptions(g,g.index,g.value,g.label,!1),g=t.select.setOptions(g,d,i,h[d]?h[d].label:void 0,!0),c.viewModel.setData([f.row,f.col],i,{noDraw:!0,eventObj:b,status:g})}),g},completedOptions:function(a,c,d,e,f,g){var h,i,j=a.viewModel.getMeta([d,e],"options"),k=-1;return h=a.getTbodyCell(d,a.viewModel.getColIndex(e)),h?(k=h.querySelector("select").selectedIndex,c=this.setOptions(c,k,j[k]?j[k].value:void 0,j[k]?j[k].label:void 0,!1)):(c.oldValue=g._previousAttributes[e],i=b(j).find(function(a){return k+=1,a.value===c.oldValue?a:void 0}),c=i?this.setOptions(c,k,c.oldValue,i.label,!1):this.setOptions(c,-1,void 0,void 0,!1)),k=-1,i=b(j).find(function(a){return k+=1,a.value===f?a:void 0}),c=i?this.setOptions(c,k,f,i.label,!0):this.setOptions(c,-1,void 0,void 0,!0)}},s),t.checkbox=b.defaults({getContent:function(c,d,e,f){var g=c.viewModel.getMeta([e,f],"options"),h=c.viewModel.checkNegativeValue(d)?[]:d.split(" "),i=[],j=[],k=a(b(g).reduce(function(a,c,d){var g=b(h).indexOf(c.value)>=0?" checked='true'":"";return g&&(i.push(d),j.push(c.label)),a+"<input type='checkbox' id='checkbox_"+e+"_"+f+"_"+d+"'"+g+"><label for='checkbox_"+e+"_"+f+"_"+d+"'>"+c.label+"</label>"},""));return k.data("status",this.setOptions({},i,h,j,!0)),k.data("pos",{row:e,col:f}),k.on("change",function(d){var e=a(this),f=e.parent().find("input[type=checkbox]"),g=e.data("pos"),h=e.data("status"),i=c.viewModel.getMeta([g.row,g.col],"options"),j=[],k=[],l=f.map(function(b,c){return a(c).prop("checked")}),m=b.chain(i).map(function(a,b){return l[b]?(j.push(b),k.push(a.label),a.value):""}).compact().value();h=t.checkbox.setOptions(h,h.index,h.value,h.label,!1),h=t.checkbox.setOptions(h,j,m,k,!0),c.viewModel.setData([g.row,g.col],m.join(" "),{noDraw:!0,eventObj:d,status:h})}),k},fillOptions:function(a,c,d,e){var f=[],g=[];return b(a).each(function(a,d){b(c).indexOf(a.value)>-1&&(f.push(d),g.push(a.label))}),this.setOptions(d,f,c,g,e)},completedOptions:function(a,b,c,d,e,f){var g=a.viewModel.getMeta([c,d],"options");return b=this.fillOptions(g,a.viewModel.checkNegativeValue(f._previousAttributes[d])?[]:f._previousAttributes[d].split(" "),b,!1),b=this.fillOptions(g,a.viewModel.checkNegativeValue(e)?[]:e.split(" "),b,!0)}},s),t.radio=b.defaults({getContent:function(c,d,e,f){var g,h=c.viewModel.getMeta([e,f],"options"),i=c.viewModel.getDataCID(e),j=-1,k=a(b(h).reduce(function(a,b,c){return d===b.value?(g=" checked='true'",j=c):g="",a+"<input type='radio' name='"+i+"' id='radio_"+e+"_"+f+"_"+c+"'"+g+"><label for='radio_"+e+"_"+f+"_"+c+"'>"+b.label+"</label>"},""));return-1===j?k.data("status",this.setOptions({},j,void 0,void 0,!0)):k.data("status",this.setOptions({},j,h[j].value,h[j].label,!0)),k.data("pos",{row:e,col:f}),k.on("change",function(d){var e,f,g=a(this),h=g.parent().find("input[type=radio]"),i=g.data("pos"),j=g.data("status"),k=c.viewModel.getMeta([i.row,i.col],"options"),l=h.map(function(b,c){return a(c).prop("checked")}),m=b.indexOf(l,!0);-1!==m&&(e=k[m].value,f=k[m].label),j=t.radio.setOptions(j,j.index,j.value,j.label,!1),j=t.radio.setOptions(j,m,e,f,!0),c.viewModel.setData([i.row,i.col],e,{noDraw:!0,eventObj:d,status:j})}),k},fillOptions:function(a,c,d,e){var f,g=-1;return b(a).each(function(a,b){c===a.value&&(g=b,f=a.label)}),this.setOptions(d,g,c,f,e)},completedOptions:function(a,b,c,d,e,f){var g=a.viewModel.getMeta([c,d],"options");return b=this.fillOptions(g,f._previousAttributes[d],b,!1),b=this.fillOptions(g,e,b,!0)}},s),t.link=b.defaults({getContent:function(c,d){var e,f,g=d,h=d;return b.isObject(d)&&(g=d.href,h=d.label,e=d.target?" target='"+d.target+"' ":"",f=d.title?" title='"+d.title+"' ":""),a("<a href='"+g+"'"+e+f+">"+h+"</a>")}},s),t.img=b.defaults({getContent:function(c,d){var e,f=d;return b.isObject(d)&&(f=d.value,e=d.alt?" alt='"+d.alt+"' ":""),a("<img src='"+f+"'"+e+" tabindex=0 />")}},s),t.button=b.defaults({getContent:function(b,c){return a("<button>"+c+"</button>")}},s),t.toggleButton=b.defaults({click:function(a,b,c){var d=!!b.viewModel.getMeta([c,"*"],"collapsed");b.clearFocusedCell(),b.viewModel.setMeta([c,"*"],"collapsed",!d)},getContent:function(b,c,d){var e=!!b.viewModel.getMeta([d,"*"],"collapsed"),f=e?"fold":"unfold";return c=c||b.viewModel.getMeta([d,"*"],"group").join("-"),a("<i class='w5-grid-group "+f+"'>"+f+"</i><span class='w5-grid-group-text'>"+c+"</span>")},dblclick:function(){return!1}},s),t.custom=b.defaults({getContent:function(a,c,d,e){var f=a.viewModel.getMeta([d,e],"template")||"<%=data%>",g=a.viewModel.getMeta([d,e],"format")||"";return b.isString(f)&&(f=b.template(f)),f({data:b.isFunction(g)?g.call(this,c):c})}},s);var u=c.View.extend({initialize:function(){}}),v={};v.checkbox=u.extend({tagName:"input",attributes:{type:"checkbox",style:"margin-left: 10px"},initialize:function(a,b,c,d,e){e=e||{},this.grid=b,this.render(a,b,c,d,e)},render:function(a,b,c,d){return this.$el.attr("id","header_checkbox_"+d[0]+"_"+d[1]),a.append(this.el),this},grid:null,events:{click:"toggleChoice"},toggleChoice:function(b){var c="",d=a(b.target).closest("th"),e=d.index(),f=this.grid.viewModel.getOption("frozenColumn"),g=f>e?e:e+this.grid.startCol-f;this.$el[0].checked&&(c=this.grid.viewModel.getCheckValue({col:g})),this.grid.col(g).set("data",c)}}),l={initialize:function(){this.collection&&this.collection.listenTo(this,"invalid",function(a,b,c){this.__invalidCallback&&this.__invalidCallback(a.toJSON(),b,c)})},validate:function(a,c){if(this.collection&&this.collection.__validator){if(b.isFunction(this.collection.__validator))return this.collection.__validator.call(null,a,c);if(b.isObject(this.collection.__validator))return this.collection.validateInfo.validate.call(this.collection,a,c,this)}}},m={validateInfo:{validate:function(a,c,d){var e=!1,f={};if(c.__validationValue={},"targetColumn"in c){var g,h,i=this.__validator[c.targetColumn],j=""+this.indexOf(d);if(i){var k=i.condition,l=i.value;k&&this.validateInfo.validator[k]&&(e=this.validateInfo.validator[k].validate.call(this,c.targetColumn,l,a,c),c.__validationValue[j]={base:l,input:a[c.targetColumn]})}else e=!1;if(f[j]=e,e)for(c.silent=!0,c.validate=!1,g=this.indexOf(d)-1;g>-1;g--)0===g&&delete c.silent,h=this.at(g),h.hasChanged()&&h.set(b.pick(h.previousAttributes(),b.keys(h.changedAttributes())),c)}else b.reduce(this.__validator,function(b,d,f){return this.validateInfo.validator[d.condition]?(e=this.validateInfo.validator[d.condition].validate.call(this,f,d.value,a,c),c.__validationValue[f]={base:d.value,input:a[f]}):e=!1,b[f]=e,b},f,this);return b.some(f)?f:!1},validator:{listOfItems:{validate:function(a,c,d){return c=this.filterInfo.getArrayValue(c),-1===b.indexOf(c,d[a])?"Check value from the list of items( "+d[a]+" )":!1}}}},filterInfo:{column_list:[],value_list:[],condition_list:[],reject:!1,defaultCondition:{text:"textIsExactly",number:"isEqualTo"},getArrayValue:function(a){return b.isArray(a)||(a=[a]),a},convertDateStringValue:function(a,b){for(var c,d=0,e=["yyyy","yy","MM","dd"],f=[];d<e.length;)c=b.search(e[d]),c>-1&&(f.push(a.substring(c,c+e[d].length)),0===d&&(d+=1)),d+=1;return f.join("")},convertDateValue:function(a,c,d){var e,f,g,h=[];return b.isString(a)&&(f=!0,e=new Date,"today"===a?(a=new Date(e.getFullYear(),e.getMonth(),e.getDate()),"dateIsAfter"===c&&a.setDate(a.getDate()+1)):"tomorrow"===a?(a=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a.setDate("dateIsAfter"===c?a.getDate()+2:a.getDate()+1)):"yesterday"===a?(a=new Date(e.getFullYear(),e.getMonth(),e.getDate()),"dateIsAfter"!==c&&a.setDate(a.getDate()-1)):"inThisWeek"===a?(a=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a.setDate("dateIsAfter"===c?a.getDate()+7-e.getDay():a.getDate()-e.getDay())):"inThisMonth"===a?(a=new Date(e.getFullYear(),e.getMonth(),1),"dateIsAfter"===c&&a.setMonth(a.getMonth()+1)):"inThisYear"===a?(a=new Date(e.getFullYear(),0,1),"dateIsAfter"===c&&a.setFullYear(a.getFullYear()+1)):(f=!1,a=new Date(a))),"dateIsAfter"===c?(b.isNumber(a)&&(a=new Date(a)),f||a.setDate(a.getDate()+1),a=a.getTime()):b.isDate(a)&&(a=a.getTime()),h.push(a),g=this.grid.viewModel.getMeta(["*",d],"originalFormat"),g&&h.push(this.filterInfo.convertDateStringValue(s.getFormattedData(a,"*",d,this.grid,{format:g}),g)),h},setConditionItems:function(a,c,d){var e,f=[],g=[];b.each(a,function(a,b){g.push(b),-1!==b.indexOf("text")?f.push(this.filterInfo.getArrayValue(a)):(-1!==b.indexOf("date")&&(e=a,a=this.filterInfo.convertDateValue.call(this,e,b,d),"dateIs"===b&&Array.prototype.push.apply(a,this.filterInfo.convertDateValue.call(this,e,"dateIsAfter",d))),f.push(a))},this),-1===c?(this.filterInfo.condition_list.push(g),this.filterInfo.value_list.push(f)):(this.filterInfo.condition_list.splice(c,1,g),this.filterInfo.value_list.splice(c,1,f))},setCondition:function(a){var c=-1;b.isObject(a)&&b.each(a,function(a,d){c=b.indexOf(this.filterInfo.column_list,d),-1===c?(this.filterInfo.column_list.push(d),this.filterInfo.setConditionItems.call(this,a,c,d)):a?this.filterInfo.setConditionItems.call(this,a,c,d):(this.filterInfo.column_list.splice(c,1),this.filterInfo.condition_list.splice(c,1),this.filterInfo.value_list.splice(c,1))},this)},filterer:{textContains:{filter:function(a,c,d){return!!b.find(d,function(b){return!!a.get(c)&&-1!==a.get(c).indexOf(b)})}},textDoesNotContain:{filter:function(a,c,d){return!!b.find(d,function(b){return!!a.get(c)&&-1===a.get(c).indexOf(b)})}},textIsExactly:{filter:function(a,c,d){return-1!==b.indexOf(d,a.get(c))}},cellIsEmpty:{filter:function(a,b){return!a.get(b)}},cellIsNotEmpty:{filter:function(a,b){return!!a.get(b)}},greaterThan:{filter:function(a,b,c){return this.filterer.compareNumber(a,b,c,function(a,b){return b>a})}},greaterThanOrEqual:{filter:function(a,b,c){return this.filterer.compareNumber(a,b,c,function(a,b){return b>=a})}},lessThan:{filter:function(a,b,c){return this.filterer.compareNumber(a,b,c,function(a,b){return a>b})}},lessThanOrEqual:{filter:function(a,b,c){return this.filterer.compareNumber(a,b,c,function(a,b){return a>=b})}},isEqualTo:{filter:function(a,b,c){return this.filterer.compareNumber(a,b,c,function(a,b){return a===b})}},isNotEqualTo:{filter:function(a,b,c){return this.filterer.compareNumber(a,b,c,function(a,b){return a!==b})}},isBetween:{filter:function(a,b,c){return this.filterer.compareNumber(a,b,c,function(a,b){return a[0]<=b&&b<=a[1]})}},isNotBetween:{filter:function(a,b,c){return this.filterer.compareNumber(a,b,c,function(a,b){return b<a[0]||a[1]<b})}},compareNumber:function(a,c,d,e){var f=a.get(c);return 0===f||f?(f=+f,b.isNumber(f)&&!b.isNaN(f)&&e(d,f)):!1},dateIsBefore:{filter:function(a,b,c){return this.filterer.compareDate.call(this,a,b,c,function(a,b){return b>a})}},dateIsAfter:{filter:function(a,b,c){return this.filterer.compareDate.call(this,a,b,c,function(a,b){return a>=b})}},compareDate:function(a,c,d,e){var f=a.get(c),g=d[0];return f?(b.isDate(f)?f=f.getTime():b.isString(f)&&(f=this.convertDateStringValue(f,a.collection.grid.viewModel.getMeta(["*",c],"originalFormat")),g=d[1]),e(f,g)):!1},dateIs:{filter:function(a,b,c){var d=4===c.length?2:1;return this.filterer.dateIsAfter.filter.call(this,a,b,c.slice(0,d))?this.filterer.dateIsBefore.filter.call(this,a,b,c.slice(d)):!1}}},filter:function(a){var b,c,d,e=!0,f=!1,g=this.column_list.length;for(b=0;g>b;b++)for(d=this.condition_list[b],c=0;c<d.length;c++){if(f=this.filterer[d[c]].filter.call(this,a,this.column_list[b],this.value_list[b][c]),!e||!f)return f;e=f}return f}},filterData:function(a,c){if(a){var d,e;this.cloneCollection(),d=this.__filtering?this.__originalCollection:this,d=d.models,this.__filtering=!0,b.isUndefined(c.reject)?c.reject=this.filterInfo.reject:b.isBoolean(c.reject)&&(this.filterInfo.reject=c.reject),b.isFunction(a)?d=c.reject?b.reject(d,a,this):b.filter(d,a,this):(e=this,this.filterInfo.setCondition.call(e,a),d=c.reject?b.reject(d,function(a){return this.filterInfo.filter(a)},this):b.filter(d,function(a){return this.filterInfo.filter(a)},this)),this.reset(d,{sort:!1})}else this.__filtering&&(this.__filtering=!1,this.filterInfo.column_list=[],this.filterInfo.value_list=[],this.filterInfo.condition_list=[],this.filterInfo.reject=!1,this.resetCollection("filter"))}},b.extend(f.prototype,{evalExpression:function(a,c,d){for(var e,f=b.keys(this.expressionFunctions).join("|"),g=new RegExp("("+f+")\\(([^)]*)\\)","gi"),h=[];e=g.exec(d);)h.push(e);return b(h).each(function(b){var e=b[1].toLowerCase(),f=this.subTotal.calculate.call(this,e,a,c,b[2]);d=d.replace(b[0],f)},this),new Function("return "+d)()},expressionFunctions:{sum:[function(a,b,c){a[0]+=this.getData([b,c])},function(a,b,c,d){a[0]+=b[c].get(d)}],count:[function(a){a[1]+=1},function(a){a[1]+=1}],average:[function(a,b,c){a[0]+=this.getData([b,c]),a[1]+=1},function(a,b,c,d){a[0]+=b[c].get(d),a[1]+=1}],max:[function(a,b,c){var d=this.getData([b,c]);a.initialized||(a[0]=d,a.initialized=!0),d>a[0]&&(a[0]=d)},function(a,b,c,d){var e=b[c].get(d);a.initialized||(a[0]=e,a.initialized=!0),e>a[0]&&(a[0]=e)}],min:[function(a,b,c){var d=this.getData([b,c]);a.initialized||(a[0]=d,a.initialized=!0),d<a[0]&&(a[0]=d)},function(a,b,c,d){var e=b[c].get(d);a.initialized||(a[0]=e,a.initialized=!0),e<a[0]&&(a[0]=e)}]},subTotal:{increaseIdx:function(a,b){return a+=b},decreaseIdx:function(a,b){return a-=b},greaterIdx:function(a,b){return a>b},lessIdx:function(a,b){return b>a},getClosedModelData:function(a,b,c,d,e){var f;if(e=e||this.collection.at(b).closedModels)for(f=0;f<e.length;f++)e[f].group?e[f].closedModels&&this.subTotal.getClosedModelData.call(this,a,-1,c,d,e[f].closedModels):d.call(this,a,e,f,c);return a},calculate:function(a,b,c,d){var e,f,g,h,i,j,k=this.getMeta([b,"*"],"group"),l=this.subTotal,m=[0,0];for(e=this.expressionFunctions[a][0],f=this.expressionFunctions[a][1],l.getClosedModelData.call(this,m,b,d,f),"header"===this.groupInfo.subTotalPosition?(g=l.increaseIdx,h=this.collection.length,i=l.lessIdx):(g=l.decreaseIdx,h=-1,i=l.greaterIdx),b=g(b,1);i(b,h);){if(j=this.getMeta([b,"*"],"group")){if(!(k&&j.length>k.length)){k=j;break}l.getClosedModelData.call(this,m,b,d,f)}else e.call(this,m,b,d);b=g(b,1)}return"count"===a?m[1]:"average"===a?m[0]/m[1]:m[0]}},filter:function(a,c){b.isUndefined(a)&&(a=null),c=c||{},this.collection.filterData(a,c,this)},group:function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r=this.view.options.groupColModel,s={silent:!0,group:!0},t=[],u=[],v=function(a){return this.getData([m,a])};for(e=e||{},arguments.length>0&&!e.sort&&this.groupInfo.grouped&&this.group(),b.isUndefined(a)?(f=[],h=[]):((b.isNumber(a)||b.isString(a))&&(a=[a]),a=b.map(a,function(a){return this.getColID(a)},this),f=a.slice(),h=a.slice()),b.isUndefined(c)||b.isNull(c)?b.isUndefined(a)?(g=[],i=[]):(g=["asc"],i=["asc"]):(b.isString(c)&&(c=[c]),g=c.slice(),i=c.slice()),m=0;m<h.length;)i[m]?(g[m]=g[m].toLowerCase(),i[m]=i[m].toLowerCase()):(g[m]="asc",i[m]="asc"),m+=1;if(s=b.extend(e,s),e=b.clone(s),q=e.subTotalPosition||this.groupInfo.subTotalPosition,this.removeRow(this.groupInfo.groupRowCIDs,e),this.groupInfo.groupRowCIDs=[],e.sort===!0?(m=-1,a=this.groupInfo.columns.slice(),h=this.groupInfo.columns.slice(),c=this.groupInfo.directions.slice(),i=this.groupInfo.directions.slice(),b.each(f,function(d,e){m=b.indexOf(this.groupInfo.columns,d),-1===m?(a.push(d),c.push(g[e])):this.groupInfo.directions[m]!==g[e]&&(c[m]=g[e],i[m]=g[e])},this),f=a,g=c):this.collection.__sorting===!0&&(0===arguments.length&&(a=this.groupInfo.columns.slice()),b.each(this.collection.sortInfo.column,function(c,d){-1===b.indexOf(a,c)&&(f.push(c),g.push(this.collection.sortInfo.direction[d]))},this)),this.sort.call(this,f,g,e),0===arguments.length)return this.groupInfo.grouped=!1,this.groupInfo.columns=[],this.groupInfo.directions=[],this.groupInfo.subTotalPosition="header",void(f.length>0&&this.view.setResize());if(this.collection.__originalCollection.stopListening(this.collection,"add remove"),this.groupInfo.grouped=!0,this.groupInfo.columns=h,this.groupInfo.directions=i,this.groupInfo.conditions=d,this.groupInfo.subTotalPosition=q,l=this.collection.length,"header"===q)for(m=0;l>m;m++){for(k=b.map(h,v,this),p=!1,n=0;n<k.length;n++)(p||0===m||k[n]!==j[n])&&(t.push(m),u.push(k.slice(0,n+1)),p=!0);j=k}else{for(m=0;l>m;m++){for(k=b.map(h,v,this),0===m&&(j=k),n=k.length-1;n>-1;n--)k[n]!==j[n]&&(t.push(m),u.push(j.slice(0,n+1)));j=k}if("footer"===q)for(n=j.length-1;n>-1;n--)t.push(m),u.push(j.slice(0,n+1))}for(l=t.length,m=l-1;m>=0;m--){if(this.addRow(t[m],[{}],e),e=b.clone(s),this.groupInfo.groupRowCIDs.push(this.getDataCID(t[m])),this.setMeta([t[m],"*"],"className","w5-grid-group-row",e),this.setMeta([t[m],"*"],"readOnly","true",e),this.setMeta([t[m],"*"],"group",u[m],e),e.inorder=!0,r)for(n=0;n<r.length;n++)for(o in r[n])this.setMeta([t[m],n],o,r[n][o],e);else this.setMeta([t[m],0],"displayType","toggleButton",e);e.inorder=!1}this.view.setResize(),this.collection.__originalCollection.listenTo(this.collection,"add remove",this.collection.syncData)},toggleGroup:function(a){var b,c,d=this.getMeta([a,"*"],"collapsed"),e=this.getMeta([a,"*"],"group"),f=[],g=[];if(e)if(d){if("header"===this.groupInfo.subTotalPosition)for(b=a+1;b<this.collection.length;b++){if(c=this.getMeta([b,"*"],"group")){if(c.length<=e.length)break;this.collection.at(b).group=!0}f.push(this.collection.at(b))}else{for(b=a-1;b>-1;b--){if(c=this.getMeta([b,"*"],"group")){if(c.length<=e.length)break;this.collection.at(b).group=!0}g.push(this.collection.at(b))}for(;g.length;)f.push(g.pop())}b=f[0].collection.indexOf(f[0]),this.collection.remove(f,{silent:!0}),"header"===this.groupInfo.subTotalPosition?this.collection.models[a].closedModels=f:this.collection.models[b].closedModels=f,this.view.drawPartial.call(this.view,b-f.length)}else f=this.collection.models[a].closedModels,delete this.collection.models[a].closedModels,b="header"===this.groupInfo.subTotalPosition?a+1:a,this.collection.add(f,{at:b,silent:!0}),this.view.drawPartial.call(this.view,b)},setValidator:function(a){b.isUndefined(a)?this.collection.__validator=null:b.isFunction(a)?this.collection.__validator=a:b.isObject(a)&&(this.collection.__validator=!this.collection.__validator||b.isFunction(this.collection.__validator)?a:b.extend(this.collection.__validator,a))},unsetValidator:function(a){!b.isFunction(a)&&b.isObject(a)&&!b.isFunction(this.collection.__validator)&&b.isObject(this.collection.__validator)&&(this.collection.__validator=b.omit(this.collection.__validator,b.keys(a)))},setInValidCallback:function(a){this.collection.__invalidCallback=b.isUndefined(a)?null:a},getValidator:function(){var a=null;return i.isObject(this.collection.__validator)?a=b.clone(this.collection.__validator):i.isFunction(this.collection.__validator)&&(a=this.collection.__validator.toString()),a}}),b.extend(q,{filterTemplate:b.template("<li><div class='w5-grid-form'><strong class='w5-dropdown-menu-label filter'>Filter</strong><i class='condition-remove-btn' title='Remove this filter condition by click.' aria-label='Remove this filter condition by click.'>X</i><div class='form-group'><select class='w5-grid-form-select select-lg'><optgroup label='Text'><option value='textContains'>Text contains</option><option value='textDoesNotContain'>Text does not contain</option><option value='textIsExactly'>Text is exactly</option><option value='cellIsEmpty'>Cell is empty</option></optgroup><optgroup label='Date'><option value='dateIs'>Date is</option><option value='dateIsBefore'>Date is before</option><option value='dateIsAfter'>Date is after</option></optgroup><optgroup label='Number'><option value='greaterThan'>Greater than</option><option value='lessThan'>Less than</option><option value='isEqualTo'>Is equal to</option><option value='isNotEqualTo'>Is not equal to</option><option value='isBetween'>Is between</option><option value='isNotBetween'>Is not between</option></optgroup></select><input class='w5-grid-form-input input-sm' type='text' /></div></div></li>"),filterTemplate_date:b.template("<select class='w5-grid-form-select select-lg'><option value='today'>today</option><option value='tomorrow'>tomorrow</option><option value='yesterday'>yesterday</option><option value='inThisWeek'>in this week</option><option value='inThisMonth'>in this month</option><option value='inThisYear'>in this year</option><option value='theDate'>the date</option></select>"),filterTemplate_input:b.template("<input class='w5-grid-form-input input-xs' type='text' />"),filterTemplate_addCondition:b.template("<li><button type='button' class='condition-add-btn'>+ Add filter condition</button></li>"),filterTemplate_btnSet:b.template("<li class='line-none'><div class='w5-btn-set align-right'><button type='button' class='btn-normal color-blue'>Apply</button><button type='button' class='btn-normal color-gray'>Cancel</button></div></li>"),validatorTemplate:b.template("<li class='line-dashed'><div class='w5-grid-form'><strong class='w5-dropdown-menu-label validator'>Validator</strong><input class='w5-grid-form-input' type='text' style='width:208px' /><button type='button' class='w5-grid-form-btn' style='width:50px'>Submit</button></div></li>"),filter:function(a,b){return this.viewModel.filter(a,b),this
},setValidator:function(a,c){this.viewModel.setValidator(a),b.isFunction(c)&&this.viewModel.setInValidCallback(c)},unsetValidator:function(a){this.viewModel.unsetValidator(a)},setInValidCallback:function(a){this.viewModel.setInValidCallback(a)},getValidator:function(){return this.viewModel.getValidator()},group:function(){return this.viewModel.group.apply(this.viewModel,arguments),this}}),b(g.fn).extend(r);var w=c.View.extend(q),x=c.Model.extend(b.extend({},j,l)),y=c.Collection.extend(b.extend({model:x},k,m));return e.Model=x,e.Collection=y,e.Grid=w,e.dataType={auto:function(a){return a},string:String,number:Number,"boolean":Boolean,date:function(a){return a}},e.formatter=function(a,c,d,f){var g;if(""===c)return a;if("number"===d||"date"!==d&&b.isNumber(a)&&-1===c.search(/yyyy|yy|M{1,2}|d{1,2}|H{1,2}|h{1,2}|m{1,2}|s{1,2}|E|a{2,4}/g)){if(g=Number(a),isNaN(g)||!isFinite(g))return a;a=g;var h,i,j=Math.abs(parseInt(a,10)),k=Number((""+a).split(".")[1]||"0"),l=c.split(".")[0],m=c.split(".")[1]||"",n=0>a?"-":"",o=c.indexOf(".")>=0?".":"",p=(l.match(/0/g)||[]).length,q=(m.match(/0/g)||[]).length,r=(m.match(/[0#]/g)||[]).length,s=l.indexOf(",")>0;for(0===q&&+(""+k).substr(0,1)>=5&&(j+=1),h=0===j?"":""+Math.abs(j),i=(""+k).substr(0,r),r>0&&+(""+k).substr(r,1)>=5&&(i=String(Number(i)+1));h.length<p;)h="0"+h;for(;i.length<q;)i+="0";return n+(s?h.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):h)+o+i}if("date"===d||b.isDate(a)){f.dayInWeek=f.dayInWeek||e.formatter.defaultDayInWeek,f.APM=f.APM||e.formatter.defaultAPM,f.originalFormat=f.originalFormat||e.formatter.defaultOriginalFormat;var t,u,v=-1,w=function(a){return 10>a?"0"+a:""+a},x={yyyy:function(a){return a.getFullYear()},yy:function(a){return this.yyyy(a).substring(2)},MM:function(a,b){return t=1+a.getMonth(),b?t:w(t)},dd:function(a,b){return b?a.getDate():w(a.getDate())},getHours:function(a){return a.getHours()},HH:function(a,b){return b?this.getHours(a):w(this.getHours(a))},hh:function(a,b){return t=(t=this.getHours(a)%12)?t:12,b?t:w(t)},mm:function(a,b){return b?a.getMinutes():w(a.getMinutes())},ss:function(a,b){return b?a.getSeconds():w(a.getSeconds())},EE:function(a){return f.dayInWeek[a.getDay()]},aa:function(a){return this.getHours(a)<12?f.APM[0]:f.APM[1]}};if(b.isString(a))return a=c.replace(/(yyyy|yy|MM|dd|HH|hh|mm|ss|E|a{2,4})/g,function(b){return v=f.originalFormat.indexOf(b),"E"===b?f.dayInWeek[+a.substring(v,v+b.length)]:a.substring(v,v+b.length)});if(b.isNumber(a)&&(a=new Date(a)),b.isDate(a))return g=a,a=c.replace(/(yyyy|yy|M{1,2}|d{1,2}|H{1,2}|h{1,2}|m{1,2}|s{1,2}|E|a{2,4})/g,function(a){return u=!1,a=a.indexOf("a")>-1?a="aa":a,1===a.length&&(u=!0,a+=a),x[a]?x[a](g,u):a})}return a},e.formatter.defaultOriginalFormat="MMddyyyy",e.formatter.defaultDayInWeek=["Sun.","Mon.","Tues.","Wed.","Thur.","Fri.","Sat."],e.formatter.defaultAPM=["AM","PM"],e});