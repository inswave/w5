/*! w5 2014-03-19 */
!function(a,b,c,d,e){"use strict";function f(a,d,e,f,g){this.option=new c.Model(this.optionDefaultObject),this.colModel=d,this.view=e,this.collection=f,this.colLinker={},this.colInvertLinker=[],this.table=new this.MetaModel({id:"table"},{rowCID:"*",colID:"*"}),this.column=new c.Collection(null,{model:this.MetaModel}),this.row=new c.Collection(null,{model:this.MetaModel}),this.cell=new c.Collection(null,{model:this.MetaModel}),this.groupInfo={grouped:!0,groupRowCIDs:[]},b(d).each(function(a,b){var c=a.id||a.headerLabel;if(!c)throw{name:"PrerequisiteError",message:"The column should be assigned one of id or headerLable."};this.colLinker[c]=b,this.colInvertLinker[b]=c},this),a.colOrder||(a.colOrder=this.colInvertLinker.slice()),this.option.set(a),b(d).each(function(a,c){b.chain(a).each(function(a,b){"id"!==b&&this.setMeta(["*",c],b,a,{inorder:!0})},this)},this),b.each(g||[],function(a){this.setMeta([a[0],a[1]],"style",a[2])},this)}function g(a,b){return new g.fn.init(a,b)}var h=function(){var a=[];return setInterval(function(){b(a).each(function(a){a.checkResize()})},200),{add:function(b){b.wrapper_width=b.$el.width(),a.push(b)}}}(),i=function(a){if(null===a)return"null";if(a&&(1===a.nodeType||9===a.nodeType))return"element";var b=Object.prototype.toString.call(a),c=b.match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===c){if(isNaN(a))return"nan";if(!isFinite(a))return"infinity"}return c};b.each(["Null","Undefined","Object","Array","String","Number","Boolean","Function","RegExp","Element","NaN","Infinite"],function(a){i["is"+a]=function(b){return i(b)===a.toLowerCase()}}),b.extend(f.prototype,{optionDefaultObject:{scrollLeft:0,scrollTop:0,frozenColumn:0,rowNum:10},metaDefaultObject:{width:100,headerLabel:"",readonly:!1,disabled:!1,displayType:"text",options:null,hidden:!1,"class":""},metaDataTypes:{style:"object",option:"object","class":"className",disabled:!0,readOnly:!0,displayType:!0,options:!0},MetaModel:c.Model.extend({initialize:function(a,b){this.rowCID=b.rowCID,this.colID=b.colID,this.type="*"===this.rowCID&&"*"===this.colID?"table":"*"===this.rowCID?"column":"*"===this.colID?"row":"cell"}}),getModel:function(a,b,c){var d,e,f;return"*"===a&&"*"===b?this.table:("*"===a?(e=b,d=this.column):"*"===b?(e=a,d=this.row):(e=a+","+b,d=this.cell),f=d.get(e)||null,!f&&c&&(f=new this.MetaModel({id:e},{rowCID:a,colID:b}),d.push(f)),f)},setData:function(a,c,d){var e,f;d=d||{},this.collection.__validator&&b.isUndefined(d.validate)&&(d.validate=!0),a[1]=this.getColID(a[1],d.inorder),"*"===a[0]&&"*"===a[1]?e=this.collection.reset(c,d):"*"===a[1]?(c=this.checkDataType(c),e=this.collection.at(a[0]).set(c,d)):"*"===a[0]?(d.silent=!0,d.save=!1,d.targetColumn=a[1],this.collection.find(function(e,g){return b(c).isArray()&&g>=c.length?void 0:(c.length===g+1&&delete d.silent,f=e.set(a[1],b(c).isArray()?c[g]:c,d),f===!1)},this)):e=this.collection.at(a[0]).set(a[1],c,d),d.save===!0&&this.save(e,d)},getCellData:function(a,c){var d=this.getMeta([a,c],"expression");return b.isFunction(d)?d.call(this.view,{rowIndex:a,colId:c,attributes:this.collection.at(a).toJSON()}):this.collection.at(a).get(c)},getData:function(a,c){c=c||{};var d,e,f,g=c.type&&"array"===c.type.toLowerCase();return a[1]=this.getColID(a[1],c.inorder),"*"===a[1]?(d="*"!==a[0],e=d?[this.collection.at(a[0])]:this.collection.models,f=b.map(e,function(a){var d,e;return d=c.pick===!0||g?this.colInvertLinker:c.pick?b.intersection(this.colInvertLinker,c.pick):c.omit?b.difference(this.colInvertLinker,c.omit):a.keys(),e=b.map(d,function(b){return this.getCellData(a.collection.indexOf(a),b)},this),g?e:b.object(d,e)},this),d?f[0]:f):"*"===a[0]?this.collection.map(function(b,c){return this.getCellData(c,a[1])},this):this.getCellData(a[0],a[1])},getDataLength:function(){return this.collection.length},getDataCID:function(a){return"*"===a||b(a).isString()?a:this.collection.at(a).cid},getMetaIndex:function(a){return this.collection.indexOf(this.collection.get(a))},setMeta:function(a,c,d,e){e=e||{},a[1]=this.getColID(a[1],e.inorder);var f=this.getModel(this.getDataCID(a[0]),a[1],!0),g={uid:b.uniqueId()};e.alter&&f.has(c)&&(g=f.get(c)),g.value=d,f.set(c,"id"===c?d:g,e)},getMeta:function(a,c,d){d=d||{},a[0]=this.getDataCID(a[0]),a[1]=this.getColID(a[1],d.inorder);var e,f,g=this.getModel(a[0],a[1]);if("*"===a[0]||"*"===a[1]||d.noncomputed)e=g&&g.has(c)?g.get(c).value:this.metaDefaultObject[c];else switch(f=b([g,this.getModel("*",a[1]),this.getModel(a[0],"*"),this.getModel("*","*")]).compact(),f=b(b.map(f,function(a){return a.get(c)})).compact(),0===f.length&&(f=[{uid:-1,value:this.metaDefaultObject[c]}]),this.metaDataTypes[c]){case"object":f=b(f).sortBy(function(a){return parseInt(a.uid,10)}),e=b(f).reduce(function(a,c){return b.extend(a,c.value)},{});break;case"className":e=b.union(b.pluck(f,"value").join(" ").split(/\s+/)).join(" ");break;default:e=b.max(f,function(a){return parseInt(a.uid,10)}).value}return e},hasMeta:function(a,b,c,d){d=d||{},a[1]=this.getColID(a[1],d.inorder);var e=this.getModel(this.getDataCID(a[0]),a[1]);return!!e&&e.has(b)},removeMeta:function(a,b,c){c=c||{},a[1]=this.getColID(a[1],c.inorder);var d=this.getModel(this.getDataCID(a[0]),a[1]);d&&d.unset(b,c)},removeMetaByDataCID:function(a){var c=this.cell.length,d=b.filter(this.cell.models,function(b){return-1===b.id.indexOf(a)});c>d.length&&this.cell.reset(d,{silent:!0}),this.row.remove(this.row.get(a),{silent:!0})},setOption:function(){return this.option.set.apply(this.option,arguments)},getOption:function(){return this.option.get.apply(this.option,arguments)},getColID:function(a,c){return"*"===a||b(a).isString()?a:b(a).isNumber()?c?this.colInvertLinker[a]:this.visibleCol[a]:null},getColIndex:function(a,c){return"*"===a||b(a).isNumber()?a:b(a).isString()?c?this.colLinker[a]:b(this.visibleCol).indexOf(a):null},updateVisibleCol:function(){var a=this.getOption("colOrder");this.visibleCol=b.reduce(a,function(a,b){return this.getMeta(["*",b],"hidden")||a.push(b),a},[],this)},getVisibleCol:function(){return this.visibleCol},getFrozenArea:function(){return b.reduce(b.range(this.getOption("frozenColumn")),function(a,b){return a+this.getMeta(["*",b],"width")},0,this)},makeJSONfromArray:function(a){var c=b.keys(this.colLinker),d=b.isArray(a[0])?!0:!1;return a=d?b.map(a,function(a){return b.object(c,a)},this):b.object(c,a)},checkDataType:function(a){if(b.isArray(a))i.isObject(a[0])||(a=this.makeJSONfromArray(a));else if(!i.isObject(a))throw new TypeError("Array, JSON data types allow only.");return a},addRow:function(a,c,d){var e;d=d||{},0===arguments.length?c={}:1===arguments.length?b.isNumber(arguments[0])?c={}:(c=this.checkDataType(a),a=null):arguments.length>=2&&(b.isObject(arguments[0])&&(d=c,c=a,a=null),c=this.checkDataType(c)),0===a?e=this.collection.unshift(c):(a&&(d.at=a),e=this.collection.add(c,d)),b.isArray(e)?b.each(e,function(a){a.__isNew=!0}):e.__isNew=!0,d.save===!0&&this.save(e,d)},removeRow:function(a,c){var d;c=c||{},b.isNumber(a)?(d=this.collection.at(a),this.removeMetaByDataCID(d.cid)):b.isString(a)&&(d=this.collection.get(a),this.removeMetaByDataCID(a)),d&&(c.destroy&&(c.url=b.result(d,"url")),d=this.collection.remove(d),b.isArray(d)?(d=b.reduce(d,function(a,b){return b.__isNew||a.push(b),a},[]),Array.prototype.push.apply(this.collection.__removeModels,d)):d.__isNew||this.collection.__removeModels.push(d),c.destroy&&this.destroy(d,c))},sort:function(a,c){b.isUndefined(a)?this.collection.sortInfo.column=[]:b.isFunction(a)?this.collection.sortInfo.column=a:((b.isNumber(a)||b.isString(a))&&(a=[a]),a=b.map(a,function(a){return this.getColID(a)},this),this.collection.sortInfo.column=a),b.isUndefined(c)?this.collection.sortInfo.direction=["asc"]:(b.isString(c)&&(c=[c]),this.collection.sortInfo.direction=c),this.collection.sortData()},fetch:function(a,c){b.isUndefined(a)?a=this.collection:i.isNumber(a)&&(a=this.collection.at(a)),a.fetch(c)},save:function(a,c){var d,e,f=c.success;c=c||{},b.isArray(a)||(d=this.collection.indexOf(a),c.pick||c.omit?(e=this.getData([d,"*"],c),c.patch=!0):e=null,c.success=function(b,d){a.__isNew=!1,f&&f(b,d,c)},this.collection.at(d).save(e,c))},destroy:function(a,c){var d=this,e=c.success;b.isArray(a)||(c.success=function(a,f){b.each(d.collection.__removeModels,function(b,c,d){a.id===b.id&&d.splice(c,1)}),e&&e(a,f,c)},a.destroy(c))},getCUData:function(a){var c={create:[],update:[],"delete":[]},d=a.excludeCreate||!1,e=a.excludeUpdate||!1,f=a.excludeDelete||!1;return d&&e||(c=b.reduce(this.collection.models,function(a,b,c){return!d&&b.__isNew?(b.__idx=c,a.create.push(b)):!e&&b.hasChanged()&&(b.__idx=c,a.update.push(b)),a},c,this)),f||Array.prototype.push.apply(c.delete,this.collection.__removeModels),c},syncData:function(a){var d=this,e=this.getCUData(a||(a={})),f=e.create.slice(),g=b.extend({},c.Events,{url:this.collection.urlCUD,getJSON:function(c){b.each(c,function(b,c,d){d[c]=this.getData([b.__idx,"*"],a),delete b.__idx},d)},toJSON:function(){return this.getJSON(e.create),this.getJSON(e.update),e}}),h=a.success,i=this;return a.success=function(c,d){i.collection.__removeModels=[],b.each(f,function(b,d){b.__isNew=!1,a.afterProcess&&c.create&&c.create[d]&&b.set(c.create[d])}),h&&h(c,d,a)},c.sync("create",g,a)},getGridData:function(){return this.collection}});var j={parse:function(a,c){if(c.saved)a=this.attributes;else if(b.isString(a)&&(a=JSON.parse(a)),this.collection&&b.isArray(a))return b.object(this.collection.keys,a);return a},defaults:function(){return this.collection&&this.collection.defaults?i.isFunction(this.collection.defaults)?this.collection.defaults.call(this):this.collection.defaults:void 0}},k={__validator:null,__invalidCallback:null,__sorting:!1,__filtering:!1,__originalCollection:null,__sortingCollection:null,__filteringCollection:null,defaults:null,initialize:function(a,b){b&&(this.grid=b.grid,this.keys=b.keys,this.url=b.url,this.urlCUD=b.urlCUD,this.defaults=b.defaults,this.__removeModels=[])},clone:function(){return new this.constructor(this.models,{grid:this.grid,keys:this.keys})},parse:function(a){return b.isString(a)?JSON.parse(a):a},cloneCollection:function(a){"filter"===a&&this.__sorting?(this.__sortingCollection=this.clone(),this.__sortingCollection.listenTo(this,"add remove",this.syncData)):"sort"===a&&this.__filtering?(this.__filteringCollection=this.clone(),this.__filteringCollection.listenTo(this,"add remove",this.syncData)):this.__sorting||this.__filtering||(this.__originalCollection=this.clone(),this.__originalCollection.listenTo(this,"add remove",this.syncData))},resetCollection:function(){this.__sortingCollection&&(this.reset(this.__filtering?this.__originalCollection.models:this.__sortingCollection.models),this.__sorting||(this.__sortingCollection.stopListening(this,"add remove",this.syncData),this.__sortingCollection=null)),this.__filteringCollection&&(this.reset(this.__sorting?this.__originalCollection.models:this.__filteringCollection.models),this.__filtering||(this.__filteringCollection.stopListening(this,"add remove",this.syncData),this.__filteringCollection=null)),this.__sorting||this.__filtering||!this.__originalCollection||(this.reset(this.__originalCollection.models),this.__originalCollection.stopListening(this,"add remove",this.syncData),this.__originalCollection=null)},syncData:function(a,c,d){var e;d.add?(0===d.at?e=this.indexOf(c.at(1)):(e=c.indexOf(a)-1,e=this.indexOf(c.at(e))+1),this.add(a,b.extend(d,{at:e,silent:!0}))):(e=this.indexOf(a),this.remove(a,b.extend(d,{index:e,silent:!0})))},sortInfo:{column:[],direction:[],comparator:function(a,c){if(!this.sortInfo.column)return 0;var d,e=this.sortInfo.column,f=this.sortInfo.direction;if(d=b.find(e,function(b){return a.attributes[b]!==c.attributes[b]}),!d){var g=a.collection.__originalCollection||a.collection,h=g.indexOf(a),i=g.indexOf(c);return h>i?1:-1}return"asc"===(f[b.indexOf(e,d)]||"asc").toLowerCase()?a.attributes[d]>c.attributes[d]?1:-1:a.attributes[d]<c.attributes[d]?1:-1}},sortData:function(){this.sortInfo.column.length>0?(this.cloneCollection("sort"),this.__sorting=!0,this.comparator=b.isFunction(this.sortInfo.column)?this.sortInfo.column:this.sortInfo.comparator,this.sort()):this.__sorting&&(this.__sorting=!1,this.comparator=null,this.resetCollection())}},l=null,m=null,n={template:b.template("<<%= tagName %> id='<%= id %>' class='gGrid<%= className %>' style='width:<%= width %>'><div class='gGrid-setTable'><div class='separateCol hide'>Adjust Column seperator</div><div class='frozenCol hide'>Adjust Column seperator</div><div class='columnMove hide'>Column Move indicator</div><table class='gGrid-table' style='width:0'><caption class='gGrid-caption'><%= caption %></caption><colgroup></colgroup><thead></thead><tbody></tbody></table><div class='gScroll-v'><button class='scrollHandler'>Move vertical scroll</button></div><div class='gScroll-h'><button class='scrollHandler'>Move horizontal scroll</button></div></div></<%= tagName %>>"),events:{"dblclick .gGrid-table thead":function(a){this.sortColumn.dblClickEvent.call(this,a)},"mousedown .gGrid-table thead":function(a){this.columnMove.downEvent.call(this,a)},"click .gGrid-table tbody":function(a){this.clickCell.clickEvent.call(this,a)},"dblclick .gGrid-table tbody":function(a){this.clickCell.clickEvent.call(this,a)},"mousedown .frozenCol":function(a){this.frozenColumn.downEvent.call(this,a)},"mousedown .gScroll-v":function(a){this.verticalScroll.areaDownEvent.call(this,a)},"mousedown .gScroll-v .scrollHandler":function(a){this.verticalScroll.handleDownEvent.call(this,a)},"mousedown .gScroll-h":function(a){this.horizontalScroll.areaDownEvent.call(this,a)},"mousedown .gScroll-h .scrollHandler":function(a){this.horizontalScroll.handleDownEvent.call(this,a)},mousewheel:function(a){this.scrollByWheel.wheelEvent.call(this,a)}},initialize:function(a){a.parseTable&&(this.parseTable(a),!this.collection&&a.collection&&(this.collection=a.collection));var c=b.map(a.colModel,function(a){return"headerLabel"in a||(a.headerLabel=a.id),a.id||a.headerLabel}),d=a.defaults||b.object(c,b.pluck(a.colModel,"default"));!this.id&&this.$el&&this.$el.attr("id")&&(this.id=this.$el.attr("id")),a.collection instanceof t?(this.collection.grid=this,this.collection.keys=a.collection.keys?a.collection.keys:c,this.collection.defaults=a.collection.defaults?a.collection.defaults:d):this.collection=new t(a.collection,{grid:this,keys:c,defaults:d,parse:!0}),this.viewModel=new f(a.option,a.colModel,this,this.collection,a.style),a.validator&&this.setValidator(a.validator),b.isFunction(a.invalidCallback)&&this.setInValidCallback(a.invalidCallback),a.fetch&&this.viewModel.fetch(this.collection,b.extend({reset:!0,silent:!0},a.fetch)),this.listenTo(this.collection,"change",this.onModelChange),this.listenTo(this.collection,"add remove",this.onModelAddRemove),this.listenTo(this.collection,"reset sort",this.onReset),this.listenTo(this.collection,"sync",this.drawWhole),this.listenTo(this.viewModel.table,"change",this.drawMetaByPos),this.listenTo(this.viewModel.column,"change",this.drawMetaByPos),this.listenTo(this.viewModel.row,"change",this.drawMetaByPos),this.listenTo(this.viewModel.cell,"change",this.drawMetaByPos),this.listenTo(this.viewModel.option,"change",this.onOptionChange)},render:function(){var b,c;return this.viewModel.updateVisibleCol(),b=a(this.template({tagName:this.tagName||"div",id:this.id,className:" "+(this.className||""),width:this.viewModel.getOption("width"),caption:this.viewModel.getOption("caption")})),this.$el.replaceWith(b),this.$el=b,c=b.find(".gGrid-setTable"),this.$wrapper_div=c,this.tableWidth=c.width(),this.wholeTblWidth=this.getWholeTblWidth(),this.rowTop=0,this.rowNum=b.find("tbody tr").length,this.startCol=0,this.endCol=b.find("colgroup col").length,this.$scrollYArea=b.find(".gScroll-v"),this.$scrollYHandle=b.find(".gScroll-v .scrollHandler"),this.$scrollXArea=b.find(".gScroll-h"),this.$scrollXHandle=b.find(".gScroll-h .scrollHandler"),this.addEvents(),this.setResize(),this},parseTable:function(c){if("TABLE"===this.$el[0].tagName){var d,e,f=this.$el.find("tr"),g=a(f[0]),h=[],i=[];f=a(b(f).rest()),b(g.find("td")).each(function(b){var c,d=a(b),e=parseInt(d.attr("colspan"),10)||1;for(h.push(d.width()),i.push(d.text()),c=1;e>c;c++)h.push(0),i.push("")}),c.colModel=b(i).map(function(a,b){return{headerLabel:a,width:h[b]}}),e=b.map(c.colModel,function(a){return a.id||a.headerLabel}),d=b(f).map(function(c){return b(a(c).find("td")).map(function(b){return a(b).text()})}),c.collection=new t(d,{keys:e,parse:!0}),c.style=[],b(f).each(function(d,e){b(a(d).find("td")).each(function(d,f){var g=a(d).attr("style")||"",h=b(g.split(/;+\s*/g)).reduce(function(a,b){var c=b.split(/:/);return 2===c.length&&(a||(a={}),a[c[0]]=c[1]),a},null);h&&c.style.push([c.collection.at(e).cid,i[f],h])})})}},createTbody:function(){var c,d,e,f,g=this.$el.find("tbody"),h=this.$el.find("colgroup"),i=this.viewModel.getOption("rowNum"),j=this.viewModel.getVisibleCol(),k=0,l="";for(this.$el.find("tr").remove(),f=0;f<j.length;f++)if(k+=this.viewModel.getMeta(["*",f],"width"),l+="<col style='width:"+this.viewModel.getMeta(["*",f],"width")+"px'>",k>=this.tableWidth){f++;break}for(i=Math.min(i,this.collection.length),c=0;i>c;c++){for(e=a("<tr class='gGrid-row'>"),d=0;f>d;d++)e.append("<td>");g.append(e)}h.append(l),e=a("<tr>"),b(b.range(f)).each(function(){var b=a("<th class='gGrid-headerLabel' scope='col'><div class='gGrid-headerLabelWrap'></th>");e.append(b)},this),this.$wrapper_div.find("thead").append(e)},addEvents:function(){this.delegateEvents(),h.add(this)},sortColumn:{dblClickEvent:function(b){var c=a(b.target).closest("th"),d=c.index(),e=this.viewModel.getOption("frozenColumn"),f=e>d?d:d+this.startCol-e;this.sortColumn.sortColumn.call(this,f,c)},sortColumn:function(a,c){var d=this.collection.sortInfo.column||[],e=this.collection.sortInfo.direction||[],f=["hide","glyphicon-sort-by-order","glyphicon-sort-by-order-alt"],g=this.viewModel.getColID(a),h=b.indexOf(d,g),i=-1===h?0:"asc"===e[h]?1:2;i=(i+1)%3,0===i?(d.splice(h,1),e.splice(h,1)):-1===h?(d.push(g),e.push(1===i?"asc":"desc")):e[h]=1===i?"asc":"desc",this.sort(d,e),c.find(".sortStatus").addClass(f[i]).removeClass(f[(i+1)%3]).removeClass(f[(i+2)%3])}},columnMove:{draggedColumn:null,_wrapMoveEvent:null,_wrapUpEvent:null,_downEvent:function(c){var d,e,f=a(c).closest("th"),g=this.viewModel.getOption("colOrder"),h=this.viewModel.getVisibleCol();a("body").addClass("noselect"),f.length>0&&(d=f.index(),e=this.viewModel.getOption("frozenColumn"),this.columnMove.draggedColumn=e>d?d:d+this.startCol-e),g[this.columnMove.draggedColumn]!==h[this.columnMove.draggedColumn]&&(this.columnMove.draggedColumn=b(g).indexOf(this.columnMove.draggedColumn))},downEvent:function(a){var c;a.target.className.indexOf("glyphicon")<0&&"A"!==a.target.tagName&&(this.columnMove._downEvent.call(this,a.target),c=this,this.columnMove._wrapMoveEvent=function(a){c.columnMove.moveEvent.call(this,a)},this.columnMove._wrapUpEvent=function(a){c.columnMove.upEvent.call(this,a)},this.columnMove._wrapMoveEvent=b.bind(this.columnMove._wrapMoveEvent,this),this.columnMove._wrapUpEvent=b.bind(this.columnMove._wrapUpEvent,this),document.addEventListener("mousemove",this.columnMove._wrapMoveEvent,!0),document.addEventListener("mouseup",this.columnMove._wrapUpEvent,!0))},_moveEvent:function(c){var d,e,f,g=a(c).closest("th"),h=this.$el.find(".columnMove"),i=this.viewModel.getOption("colOrder"),j=this.viewModel.getVisibleCol();g.length>0&&(d=g.index(),e=this.viewModel.getOption("frozenColumn"),f=e>d?d:d+this.startCol-e,i[this.columnMove.targetIndex]!==j[this.columnMove.targetIndex]&&(this.columnMove.targetIndex=b(i).indexOf(this.columnMove.draggedColumn)),f===this.columnMove.draggedColumn?h.addClass("hide").removeClass("show"):h.addClass("show").removeClass("hide").css({top:g.position().top,height:g.outerHeight(),left:g.position().left+(f<this.columnMove.draggedColumn?0:g.outerWidth())}))},moveEvent:function(a){this.columnMove.draggedColumn&&this.columnMove._moveEvent.call(this,a.target)},_upEvent:function(c){var d,e,f,g=a(c).closest("th"),h=this.$el.find(".columnMove"),i=this.viewModel.getOption("colOrder"),j=this.viewModel.getVisibleCol();g.length>0&&(d=g.index(),e=this.viewModel.getOption("frozenColumn"),f=e>d?d:d+this.startCol-e,i[this.columnMove.targetIndex]!==j[this.columnMove.targetIndex]&&(this.columnMove.targetIndex=b(i).indexOf(this.columnMove.draggedColumn)),this.columnMove.draggedColumn!==f&&this.moveColumn(this.columnMove.draggedColumn,f)),a("body").removeClass("noselect"),h.addClass("hide").removeClass("show"),this.columnMove.draggedColumn=null},upEvent:function(a){this.columnMove._upEvent.call(this,a.target),document.removeEventListener("mousemove",this.columnMove._wrapMoveEvent,!0),document.removeEventListener("mouseup",this.columnMove._wrapUpEvent,!0)}},frozenColumn:{frozenColumnIdx:null,newFrozenCol:-1,dragInfo:{},_wrapMoveEvent:null,_wrapUpEvent:null,_downEvent:function(a){this.frozenColumn.frozenColumnIdx=this.viewModel.getOption("frozenColumn"),this.frozenColumn.dragInfo={startX:a-this.$wrapper_div.offset().left,endX:0}},downEvent:function(a){var c=this;this.frozenColumn._downEvent.call(this,a.clientX),this.frozenColumn.$frozenHandle=this.$el.find(".frozenCol"),this.frozenColumn.$seperateCol=this.$el.find(".separateCol"),this.frozenColumn.$indicator=this.$el.find(".columnMove"),this.frozenColumn._wrapMoveEvent=function(a){c.frozenColumn.moveEvent.call(this,a)},this.frozenColumn._wrapUpEvent=function(a){c.frozenColumn.upEvent.call(this,a)},this.frozenColumn._wrapMoveEvent=b.bind(this.frozenColumn._wrapMoveEvent,this),this.frozenColumn._wrapUpEvent=b.bind(this.frozenColumn._wrapUpEvent,this),document.addEventListener("mousemove",this.frozenColumn._wrapMoveEvent,!0),document.addEventListener("mouseup",this.frozenColumn._wrapUpEvent,!0)},_moveEvent:function(a){var b,c=-1,d=0,e=0,f=this.viewModel.getVisibleCol();for(this.frozenColumn.dragInfo.endX=a-this.$wrapper_div.offset().left,this.frozenColumn.$seperateCol.css("left",this.frozenColumn.dragInfo.endX),this.frozenColumn.$seperateCol.removeClass("hide").addClass("show"),this.frozenColumn.newFrozenCol=-1,b=0;b<f.length;b++)if(d=this.viewModel.getMeta(["*",b],"width"),e+=d,-1===this.frozenColumn.newFrozenCol)e-d/2>=this.dragInfo.endX&&(this.frozenColumn.newFrozenCol=c=b,e=d);else if(c=b,e>this.$wrapper_div.width())break;if(this.frozenColumn.frozenColumnIdx!==this.frozenColumn.newFrozenCol)for(e=0,b=0;b<this.frozenColumn.newFrozenCol;b++)e+=this.viewModel.getMeta(["*",b],"width");this.frozenColumn.$indicator.removeClass("hide").addClass("show").css({top:this.$wrapper_div.find("table thead").position().top,height:this.$wrapper_div.find("table thead").outerHeight(),left:e})},moveEvent:function(a){this.frozenColumn._moveEvent.call(this,a.clientX)},_upEvent:function(){this.frozenColumn.$seperateCol.removeClass("show").addClass("hide"),this.frozenColumn.$indicator.removeClass("show").addClass("hide"),this.viewModel.setOption("frozenColumn",this.frozenColumn.newFrozenCol),this.drawByScroll()},upEvent:function(a){this.frozenColumn._upEvent.call(this,a.target),document.removeEventListener("mousemove",this.frozenColumn._wrapMoveEvent,!0),document.removeEventListener("mouseup",this.frozenColumn._wrapUpEvent,!0)}},verticalScroll:{pos:null,_wrapMoveEvent:null,_wrapUpEvent:null,_areaDownEvent:function(a){var b,c=this.rowTop,d=this.viewModel.getOption("vScrollDegree")||this.viewModel.getOption("rowNum");c+=(a<this.$scrollYHandle.position().top?-1:1)*d,b=20*c,this.viewModel.setOption("scrollTop",b)},areaDownEvent:function(a){this.verticalScroll._areaDownEvent.call(this,a.offsetY)},_handleDownEvent:function(a){var b=this.$scrollYHandle.position().top;this.verticalScroll.pos={top:b,currentY:a}},handleDownEvent:function(a){var c=this;this.verticalScroll._handleDownEvent.call(this,a.clientY),a.preventDefault(),a.stopPropagation(),this.verticalScroll._wrapMoveEvent=function(a){c.verticalScroll.moveEvent.call(this,a)},this.verticalScroll._wrapUpEvent=function(a){c.verticalScroll.upEvent.call(this,a)},this.verticalScroll._wrapMoveEvent=b.bind(this.verticalScroll._wrapMoveEvent,this),this.verticalScroll._wrapUpEvent=b.bind(this.verticalScroll._wrapUpEvent,this),document.addEventListener("mousemove",this.verticalScroll._wrapMoveEvent,!0),document.addEventListener("mouseup",this.verticalScroll._wrapUpEvent,!0)},_moveEvent:function(a){if(this.verticalScroll.pos){var b=this.$scrollYArea.height()-this.$scrollYHandle.height(),c=parseInt(this.verticalScroll.pos.top+a-this.verticalScroll.pos.currentY,10),d=this.wholeTblHeight-20*this.viewModel.getOption("rowNum"),e=c*d/b;this.viewModel.setOption("scrollTop",e)}},moveEvent:function(a){this.verticalScroll._moveEvent.call(this,a.clientY)},_upEvent:function(){this.verticalScroll.pos=null},upEvent:function(){this.verticalScroll._upEvent.call(this),document.removeEventListener("mousemove",this.verticalScroll._wrapMoveEvent,!0),document.removeEventListener("mouseup",this.verticalScroll._wrapUpEvent,!0)}},horizontalScroll:{pos:null,_wrapMoveEvent:null,_wrapUpEvent:null,_areaDownEvent:function(a){var b=this.$scrollXHandle.position().left,c=this.$scrollXArea.width()-this.$scrollXHandle.width(),d=b*(this.wholeTblWidth-this.tableWidth)/c,e=this.viewModel.getFrozenArea();d+=(b>a?-1:1)*(this.tableWidth-e),this.viewModel.setOption("scrollLeft",d)},areaDownEvent:function(a){this.horizontalScroll._areaDownEvent.call(this,a.offsetX)},_handleDownEvent:function(a){this.horizontalScroll.pos={left:this.$scrollXHandle.position().left,currentX:a}},handleDownEvent:function(a){var c=this;this.horizontalScroll._handleDownEvent.call(this,a.clientX),a.preventDefault(),a.stopPropagation(),this.horizontalScroll._wrapMoveEvent=function(a){c.horizontalScroll.moveEvent.call(this,a)},this.horizontalScroll._wrapUpEvent=function(a){c.horizontalScroll.upEvent.call(this,a)},this.horizontalScroll._wrapMoveEvent=b.bind(this.horizontalScroll._wrapMoveEvent,this),this.horizontalScroll._wrapUpEvent=b.bind(this.horizontalScroll._wrapUpEvent,this),document.addEventListener("mousemove",this.horizontalScroll._wrapMoveEvent,!0),document.addEventListener("mouseup",this.horizontalScroll._wrapUpEvent,!0)},_moveEvent:function(a){if(this.horizontalScroll.pos){var b=this.$scrollXArea.width()-this.$scrollXHandle.width(),c=parseInt(this.horizontalScroll.pos.left+a-this.horizontalScroll.pos.currentX,10),d=this.wholeTblWidth-this.tableWidth,e=c*d/b;this.viewModel.setOption("scrollLeft",e)}},moveEvent:function(a){this.horizontalScroll._moveEvent.call(this,a.clientX)},_upEvent:function(){this.horizontalScroll.pos=null},upEvent:function(){this.horizontalScroll._upEvent.call(this),document.removeEventListener("mousemove",this.horizontalScroll._wrapMoveEvent,!0),document.removeEventListener("mouseup",this.horizontalScroll._wrapUpEvent,!0)}},scrollByWheel:{wheelEvent:function(a){var b=a.originalEvent||a,c=0,d=0;"detail"in b&&(d=-1*b.detail),"wheelDelta"in b&&(d=b.wheelDelta),"wheelDeltaY"in b&&(d=b.wheelDeltaY),"wheelDeltaX"in b&&(c=-1*b.wheelDeltaX),Math.abs(d)<40?d*=20:d/=2,this.scrollBy(c,d),a.preventDefault(),a.stopPropagation()}},clickCell:{clickEvent:function(b){var c=a(b.target).closest("tr").index()+this.rowTop,d=a(b.target).closest("td").index(),e=this.viewModel.getOption("frozenColumn"),f=e>d?d:d+this.startCol-e,g=this.viewModel.getMeta([c,f],"displayType");q[g][b.type]&&q[g][b.type](b,this,c,f)}},onModelChange:function(a){var c=a.collection.indexOf(a);b.each(a.changed,function(a,b){this.drawCell(c,b)},this)},onModelAddRemove:function(a,b,c){var d=b.indexOf(a);-1===d&&(d=c.index||0),this.drawTbody(d)},onReset:function(){this.$wrapper_div&&(this.viewModel.setOption("scrollLeft",0,{silent:!0}),this.viewModel.setOption("scrollTop",0,{silent:!0}),this.setResize())},drawWhole:function(a){a instanceof t&&(this.createTbody(),this.onReset())},drawMetaByPos:function(a){var c,d;if(a.hasChanged("width")||a.hasChanged("flex")||a.hasChanged("hidden"))return void("column"===a.type&&(this.viewModel.updateVisibleCol(),this.setResize()));if(a.hasChanged("closed")&&"row"===a.type&&(d=a.get("id").split(","),d[0]=this.viewModel.getMetaIndex(d[0]),this.viewModel.toggleGroup(d[0])),"table"===a.type)this.drawTbody();else if("row"===a.type||b(a.changed).keys().length>1)d=this.viewModel.getMetaIndex(a.id),this.drawTbody(d,d);else if("column"===a.type)for(d=a.get("id"),c=this.rowTop;c<this.rowTop+this.viewModel.getOption("rowNum");c++)this.drawCell(c,d);else d=a.get("id").split(","),d[0]=this.viewModel.getMetaIndex(d[0]),this.drawCell(d[0],d[1])},drawByScroll:function(){if(this.$el){var c,d,e,f,g,h,i=this.viewModel.getOption("scrollLeft"),j=this.viewModel.getOption("scrollTop"),k=this.viewModel.getOption("frozenColumn"),l=this.wholeTblWidth-this.tableWidth,m=this.wholeTblHeight-20*this.viewModel.getOption("rowNum"),n=this.$el.find(".frozenCol"),o=this.$el.find("colgroup col"),p=this.viewModel.getFrozenArea(),q=this.viewModel.getVisibleCol(),r=this.$scrollYArea.height()-this.$scrollYHandle.height(),s=0,t=-1,u=-1,v=!1;for(i>l&&(i=l),0>i&&(i=0),i=parseInt(i,10),this.viewModel.setOption("scrollLeft",i,{silent:!0}),n.css("left",p).toggleClass("hide",!p).toggleClass("show",!!p),this.$scrollXArea.css("left",p),this.$scrollXHandle.width(this.$scrollXArea.width()*this.tableWidth/this.wholeTblWidth),d=this.$scrollXArea.width()-this.$scrollXHandle.width(),c=d*i/(this.wholeTblWidth-this.tableWidth),this.$scrollXHandle.css("left",c+"px"),e=k;e<q.length;e++)if(f=this.viewModel.getMeta(["*",e],"width"),s+=f,-1===t)s-f/2>=i&&(t=u=e,s=f);else if(u=e,s>this.$scrollXArea.width())break;if(this.$scrollXArea.css("opacity",this.$scrollXArea.width()<=this.$scrollXHandle.width()?0:1),this.startCol!==t||this.endCol!==u){for(this.startCol=t,this.endCol=u,e=o.length;u-t+k>=e;e++)this.$el.find("colgroup").append("<col>"),this.$el.find("thead tr").append("<th><div class='gGrid-headerLabelWrap'></th>"),this.$el.find("tbody tr").append("<td>");o=this.$el.find("colgroup col"),this.$el.find("table").width(s+p),b(o).each(function(b,c){var d=k>c?c:c+t-k,e=u>=d?this.viewModel.getMeta(["*",d],"width"):0;a(b).width(e),0===e&&a(this.getHeaderCell(0,c)).children(0).html("")},this),v=!0}j>m&&(j=m),0>j&&(j=0),j=parseInt(j,10),this.viewModel.setOption("scrollTop",j,{silent:!0}),g=parseInt(j*r/m+.5,10),this.$scrollYHandle.css("top",g+"px"),h=parseInt(j/20,10),this.rowTop!==h&&(this.rowTop=h,v=!0),this.$scrollYArea.css("opacity",this.$scrollYArea.height()<=this.$scrollYHandle.height()?0:1),v&&(this.drawHeader(),this.drawTbody())}},onOptionChange:function(a){a.hasChanged("colOrder")&&(this.viewModel.updateVisibleCol(),this.setResize()),a.hasChanged("frozenColumn")&&(this.wholeTblWidth=this.getWholeTblWidth(),this.viewModel.setOption("scrollLeft",0,{silent:!0}),this.drawByScroll()),(a.hasChanged("scrollLeft")||a.hasChanged("scrollTop"))&&this.drawByScroll(),a.hasChanged("width")&&(this.$el.css("width",a.get("option").value.width),this.setResize())},getHeaderCell:function(a,b){return this.$el.find("table thead tr:nth-child("+(a+1)+")").find("th:nth-child("+(b+1)+")")[0]},getTbodyCell:function(a,b){return this.$el.find("table tbody tr:nth-child("+(a+1)+")").find("td:nth-child("+(b+1)+")")[0]},getWholeTblWidth:function(){var a,b,c=0,d=-1,e=this.viewModel.getOption("frozenColumn"),f=this.viewModel.getFrozenArea(),g=this.viewModel.getVisibleCol();for(b=g.length-1;b>=e;b--){if(a=this.viewModel.getMeta(["*",b],"width"),b!==g.length-1&&c+a>this.tableWidth-f){d=b;break}c+=a}for(c=0,b=e;d>=b;b++)c+=this.viewModel.getMeta(["*",b],"width");return c+this.tableWidth},getWholeTblHeight:function(){return 20*this.viewModel.getDataLength()},drawHeader:function(){for(var a=this.viewModel.getOption("frozenColumn"),b=0;a>b;b++)this.drawHeaderCell(0,b);for(b=this.startCol;b<=this.endCol;b++)this.drawHeaderCell(0,b)},drawTbody:function(a,b){var c,d=this.viewModel.getOption("frozenColumn");for(a=a||this.rowTop,arguments.length<2&&(b=this.rowTop+this.viewModel.getOption("rowNum")-1),c=a;b>=c;c++){for(var e=0;d>e;e++)this.drawCell(c,e);
for(e=this.startCol;e<=this.endCol;e++)this.drawCell(c,e)}},drawHeaderCell:function(c,d){var e=this.viewModel.getColIndex(d),f=this.viewModel.getOption("colOrder"),g=this.viewModel.getOption("frozenColumn"),h=this.viewModel.getVisibleCol(),i=g>e?e:e-this.startCol+g,j=this.getHeaderCell(0,i);j&&a(j).children(0).html("").append(this.viewModel.getMeta(["*",d],"headerLabel")).append(this.getColMenu(e)).append(this.getAdjustColHandle(e));var k=b(f).indexOf(h[d]),l=f[k-1];0===k||b(h).indexOf(l)>=0?a(j).find(".display-left .glyphicon-step-backward").addClass("hide"):a(j).find(".display-left .glyphicon-step-backward").removeClass("hide")},drawCell:function(b,c){var d,e,f,g,h,i=this.viewModel.getColIndex(c),j=this.viewModel.getOption("frozenColumn"),k=j>i||this.startCol<=i&&i<=this.endCol,l=this.rowTop<=b&&b<this.rowTop+this.viewModel.getOption("rowNum"),m=j>i?i:i-this.startCol+j;k&&l&&(d=a(this.getTbodyCell(b-this.rowTop,m)),d.length>0&&(b<this.viewModel.getDataLength()?(e=this.viewModel.getData([b,c]),f=q[this.viewModel.getMeta([b,c],"displayType")],d.html("").append(f.getContent(this,e,b,i)),g=this.viewModel.getMeta([b,c],"style"),h=this.viewModel.getMeta([b,c],"class")||""):(d.html(""),g=null,h=""),d[0].style.cssText="",g&&d.css(g),d.attr("class",h)))},getAdjustColHandle:function(){var c=this,d={$adjustHandle:a("<button class='adjustCol-handle'>Adjust this Column</button>"),$seperateCol:c.$el.find(".separateCol"),targetCol:0,targetColW:0,draggingX:0,colDragInfo:{},downEvent:function(b){var d=c.$wrapper_div.find("thead th").eq(a(b.target).parent().closest("th").index()+1);this.targetCol=a(b.target).parent().closest("th").index(),this.targetColW=a(b.target).parent().closest("th").width(),this.colDragInfo={posX:b.clientX,startX:d.position().left},this.$seperateCol.css("left",this.colDragInfo.startX),this.$seperateCol.removeClass("hide").addClass("show"),document.addEventListener("mousemove",this.moveEvent,!0),document.addEventListener("mouseup",this.upEvent,!0),b.stopPropagation()},moveEvent:function(b){this.draggingX=b.clientX-this.colDragInfo.posX,this.$seperateCol.css("left",this.colDragInfo.startX+this.draggingX-this.$seperateCol.width()),a("body").addClass("sizingH")},upEvent:function(){var b=c.viewModel.getOption("frozenColumn");this.targetCol>=b&&(this.targetCol+=c.startCol-b);var d=c.viewModel.getMeta(["*",this.targetCol],"width");c.viewModel.removeMeta(["*",this.targetCol],"flex",{silent:!0}),c.viewModel.setMeta(["*",this.targetCol],"width",d+this.draggingX),this.$seperateCol.removeClass("show").addClass("hide"),a("body").removeClass("sizingH"),document.removeEventListener("mousemove",this.moveEvent,!0),document.removeEventListener("mouseup",this.upEvent,!0)}};return b(d).bindAll("downEvent","moveEvent","upEvent"),d.$adjustHandle.on("mousedown",d.downEvent),d.$adjustHandle},colLeftMenu:b.template("<div class='gGrid-colMenu display-left'><span class='glyphicon glyphicon-step-backward'></span></div>"),colRightMenu:b.template("<div class='gGrid-colMenu display-right'><span class='sortStatus glyphicon hide'></span><span class='glyphicon glyphicon-chevron-down'></span><ul class='dropdown-menu' role='menu'><li><a href='#'>Column Hide</a></li></ul></div>"),getColMenu:function(c){var d=this,e=a(document.createDocumentFragment()),f=a(this.colLeftMenu()),g=a(this.colRightMenu()),h={_showCol:function(){var a,e=d.viewModel.getOption("colOrder"),f=d.viewModel.getVisibleCol(),g=b(e).indexOf(f[c])-1,h=b(e).indexOf(f[c-1]);for(a=g;a>=h&&a>=0;a--)d.viewModel.setMeta(["*",e[a]],"hidden",!1)},showCol:function(a){this._showCol(a.target)}};b(h).bindAll("showCol"),f.find(".glyphicon-step-backward").on("click",h.showCol),e.append(f);var i={_openColMenu:function(b){var c,e=0,f=a(b).closest("th"),h=f.index();for(d.$el.find("thead th .gGrid-colMenu.display-right").removeClass("open"),c=0;h>=c;c++)e+=d.$el.find("thead th").eq(c).width();e>d.$wrapper_div.width()-f.find(".display-right .dropdown-menu").width()&&f.find(".display-right .dropdown-menu").css({left:"initial",right:"0px"}),g.hasClass("open")||g.addClass("open")},openColMenu:function(a){this._openColMenu(a.target)},_closeColMenu:function(){g.hasClass("open")&&g.removeClass("open")},closeColMenu:function(a){this._closeColMenu(a.target)},_hideCol:function(){d.viewModel.setMeta(["*",c],"hidden",!0)},hideCol:function(a){this._hideCol(a.target),a.preventDefault()}};return b(i).bindAll("openColMenu","closeColMenu","hideCol"),g.find(".glyphicon").eq(1).on("click",i.openColMenu),g.find(".dropdown-menu li").eq(0).on("click",i.hideCol),d.$el.on("mouseleave",i.closeColMenu),e.append(g),"hidden"!==this.viewModel.getMeta(["*",c],"colMenu")?e:void 0},setFlex:function(){var a=this.tableWidth,c=0,d=[],e=0;if(b(this.viewModel.getVisibleCol()).each(function(b,c){if(this.viewModel.hasMeta(["*",c],"flex")){var f=this.viewModel.getMeta(["*",c],"flex");d.push({col:c,flex:f,diff:0}),e+=f}else a-=this.viewModel.getMeta(["*",c],"width")},this),0!==d.length){for(var f=0;f<d.length;f++)d[f].width=parseInt(d[f].flex*a/e,10),c+=d[f].width;for(a-=c,f=0;a>f;f++){for(var g=1/0,h=-1,i=0;i<d.length;i++){var j=d[i].diff+1,k=d[i].width;g>j*(c/k)&&(g=j*(c/k),h=i)}d[h].diff+=1}for(f=0;f<d.length;f++){var l=["*",d[f].col];l.silent=!0,this.viewModel.setMeta(l,"width",d[f].width+d[f].diff,{silent:!0})}}},setResize:function(){this.tableWidth=this.$wrapper_div.width(),this.setFlex(),this.wholeTblWidth=this.getWholeTblWidth(),this.wholeTblHeight=this.getWholeTblHeight(),this.$scrollYHandle.height(this.$el.find("tbody tr").length*this.$scrollYArea.height()/this.viewModel.getDataLength()),this.$scrollXHandle.width(this.$scrollXArea.width()*this.tableWidth/this.wholeTblWidth),this.startCol=this.endCol=-1,this.createTbody(),this.drawByScroll()},checkResize:function(){var a=this.$el.width();this.wrapper_width!==a&&(this.wrapper_width=a,this.setResize())},redraw:function(){return this.setResize(),this},scrollTo:function(a,b){return this.viewModel.setOption({scrollLeft:a||0,scrollTop:b||0}),this},scrollBy:function(a,b){return this.viewModel.setOption({scrollLeft:this.viewModel.getOption("scrollLeft")+(a||0),scrollTop:this.viewModel.getOption("scrollTop")+(b||0)}),this},moveColumn:function(a,b){var c=this.viewModel.getOption("colOrder").slice(),d=c.splice(a,1)[0];return c.splice(b,0,d),this.viewModel.setOption("colOrder",c),this},addRow:function(){return this.viewModel.addRow.apply(this.viewModel,arguments),this},removeRow:function(a,b){return this.viewModel.removeRow(a,b),this},reset:function(a){return a=a||[],this.viewModel.model.meta.table.clear({silent:!0}),this.viewModel.model.meta.row.reset([],{silent:!0}),this.viewModel.model.meta.column.reset([],{silent:!0}),this.viewModel.model.meta.cell.reset([],{silent:!0}),b(this.viewModel.colModel).each(function(a,c){b.chain(a).each(function(a,b){"id"!==b&&this.viewModel.setMeta(["*",c],b,a,{inorder:!0,silent:!0})},this)},this),this.viewModel.collection.reset(a),this},sort:function(a,b){return this.viewModel.sort(a,b),this},getRowLength:function(){return this.viewModel.getDataLength()},getColLength:function(){return this.viewModel.getVisibleCol().length},_getColLength:function(){return this.viewModel.getOption("colOrder").length},getCollection:function(){return this.viewModel.collection},setColumnVisible:function(a,c){return b.isNumber(a)&&this.viewModel.setMeta(["*",a],"hidden",!c,{inorder:!0}),b.isArray(a)&&b(a).each(function(a){this.viewModel.setMeta(["*",a],"hidden",!c,{inorder:!0})},this),this},getColumnVisibility:function(a){var c=this.viewModel.getOption("colOrder"),d=this.viewModel.getVisibleCol();return"hidden"===a?b(c).difference(d):d},_cell:function(a,b){return new g(this,[a,this.viewModel.getColID(b,!0)])},_row:function(a){return new g(this,[a,"*"])},_col:function(a){return new g(this,["*",this.viewModel.getColID(a,!0)])},cell:function(a,b){return new g(this,[a,this.viewModel.getColID(b)])},row:function(a){return new g(this,[a,"*"])},col:function(a){return new g(this,["*",this.viewModel.getColID(a)])},table:function(){return new g(this,["*","*"])},option:function(){return this.viewModel.option},fetch:function(a,b){return this.viewModel.fetch(a,b),this},syncData:function(a){return this.viewModel.syncData(a),this},getGridData:function(){return this.viewModel.getGridData()},find:function(a,b,c){c=c||[];var d;return d=this.matchExp.exec(a),b=b||this,!d||"row"!==d[1]&&"column"!==d[1]||(b=b.collection,"removed"===d[2]&&Array.prototype.push.apply(c,b.__removeModels)),c},matchExp:/(cell|row|column):(\S+)/i};g.fn=g.prototype={constructor:g,init:function(a,b){this.grid=a,this.viewModel=a.viewModel,this.push(b)},clone:function(a){this.grid=a},length:0,push:[].push,slice:[].slice,splice:[].splice,sort:[].sort},g.fn.init.prototype=g.fn,g.fn.clone.prototype=g.fn;var o={get:function(a){var c=[].slice.call(arguments,1);if("data"===a)return this.viewModel.getData.apply(this.viewModel,[this[0]].concat(c));if("option"===a)return this.viewModel.getOption.apply(this.viewModel,c);var d,e=b.isString(c[0]);return c=[this[0],a,e?c[1]:c[0]],d=this.viewModel.getMeta.apply(this.viewModel,c),e&&(d=d[arguments[1]]),d},set:function(a){var c=[].slice.call(arguments,1);return b(this).each(function(d){if("data"===a)this.viewModel.setData.apply(this.viewModel,[d].concat(c));else if("option"===a)this.viewModel.setOption.apply(this.viewModel,c);else{var e,f=b.isString(c[1]);f?(e=b.clone(this.viewModel.getMeta(d,a,{noncomputed:!0}))||{},e[c[0]]=c[1],c=[this[0],a,e,c[2]]):c=[this[0],a,c[0],c[1]],this.viewModel.setMeta.apply(this.viewModel,c)}},this),this},alter:function(a,c,d){var e=arguments;return b(this).each(function(f){if("data"===a)this.viewModel._setData.apply(this.bobj,[f].concat([].slice.call(e,1)));else if(2===e.length)this.viewModel.setMeta(f,a,c,{alter:!0});else{var g=b.clone(this.viewModel.getMeta(f,a))||{};g[c]=d,this.viewModel.setMeta(f,a,g,{alter:!0})}},this),this},has:function(a,b){if(1===arguments.length)return this.viewModel.hasMeta(this[0],a);var c=this.viewModel.getMeta(this[0],a)||{};return c.hasOwnProperty(b)},unset:function(a,c){var d=arguments;return b(this).each(function(e){if(2===d.length)this.viewModel.removeMeta(e,a);else{var f=b.clone(this.viewModel.getMeta(e,a))||{};delete f[c],this.viewModel.setMeta(e,a,f)}},this),this},addClass:function(a){var b=this.viewModel.getMeta(this[0],"class",{noncomputed:!0});return 0===b.length?this.viewModel.setMeta(this[0],"class",a):this.viewModel.setMeta(this[0],"class",b+" "+a),this},hasClass:function(a){var c=this.viewModel.getMeta(this[0],"class",{noncomputed:!0}),d=!1;return b(c.split(/\s+/)).each(function(b){b===a&&(d=!0)}),d},removeClass:function(a){var c=this.viewModel.getMeta(this[0],"class",{noncomputed:!0});return 0!==c.length&&this.viewModel.setMeta(this[0],"class",b(c.split(/\s+/)).difference(a.split(/\s+/)).join(" ")),this},toggleClass:function(a,c){var d,e=this.viewModel.getMeta(this[0],"class",{noncomputed:!0});return 1===arguments.length&&(b(e.split(/\s+/)).each(function(b,c){b===a&&(d=c)}),c=b.isUndefined(d)?!0:!1),c?this.addClass(a):this.removeClass(a),this}},p={alterValue:function(a,b,c){b.firstChild.value=c}},q={};q.text=b.defaults({$editBox:a("<div class='w5_grid_editbox' contenteditable='true'>"),getContent:function(a,c,d,e){var f=a.viewModel.getMeta([d,e],"template")||"<%=data%>";return b.isString(f)&&(f=b.template(f)),f({data:c})},dblclick:function(a,b,c,d){var e=b.viewModel.getMeta([c,d],"readOnly");e||this.popupEditBox(b,c,d)},popupEditBox:function(b,c,e){var f=b.viewModel.getOption("frozenColumn"),g=f>e?e:e-b.startCol+f,h=a(b.getTbodyCell(c-b.rowTop,g)),i=b.viewModel.getData([c,e]);if(b.$el.append(this.$editBox),this.$editBox.text(i).css({width:"auto","min-width":h.outerWidth(),height:h.outerHeight(),top:h.offset().top-b.$el.offset().top,left:h.offset().left-b.$el.offset().left}).show().data({row:c,col:e,grid:b}),this.$editBox.focus(),"undefined"!=typeof d.getSelection&&"undefined"!=typeof document.createRange){var j=document.createRange();j.selectNodeContents(this.$editBox[0]),j.collapse(!1);var k=d.getSelection();k.removeAllRanges(),k.addRange(j)}else if("undefined"!=typeof document.body.createTextRange){var l=document.body.createTextRange();l.moveToElementText(this.$editBox[0]),l.collapse(!1),l.select()}},endEdit:function(a){if("blur"===a.type||"keydown"===a.type&&13===a.keyCode){var b=this.$editBox.text(),c=this.$editBox.data("row"),d=this.$editBox.data("col"),e=this.$editBox.data("grid");e.viewModel.setData([c,d],b),this.$editBox.hide()}}},p),b(q.text).bindAll("dblclick","popupEditBox","endEdit"),a(q.text.$editBox).on("blur keydown",q.text.endEdit),q.select=b.defaults({getContent:function(c,d,e,f){var g,h,i=c.viewModel.getMeta([e,f],"options");for(g=a("<select>"+b(i).reduce(function(a,b){return a+"<option>"+b.label+"</option>"},"")+"</select>"),h=0;h<i.length;h++)if(i[h].value===d){g.val(i[h].label);break}return g.data("pos",{row:e,col:f}),g.on("change",function(){var d=a(this),e=d.data("pos"),f=d.val(),g=c.viewModel.getMeta([e.row,e.col],"options"),h=b(g).findWhere({label:f}).value;c.viewModel.setData([e.row,e.col],h)}),g}},p),q.checkbox=b.defaults({getContent:function(c,d,e,f){var g=c.viewModel.getMeta([e,f],"options"),h=d.split(" "),i=a(b(g).reduce(function(a,c,d){var g=b(h).indexOf(c.value)>=0?" checked='true'":"";return a+"<input type='checkbox' id='checkbox_"+e+"_"+f+"_"+d+"'"+g+"><label for='checkbox_"+e+"_"+f+"_"+d+"'>"+c.label+"</label>"},""));return i.data("pos",{row:e,col:f}),i.on("change",function(){var d=a(this),e=d.parent().find("input[type=checkbox]"),f=d.data("pos"),g=c.viewModel.getMeta([f.row,f.col],"options"),h=e.map(function(b,c){return a(c).prop("checked")}),i=b.chain(g).map(function(a,b){return h[b]?a.value:""}).compact().value().join(" ");c.viewModel.setData([f.row,f.col],i,{silent:!0})}),i}},p),q.radio=b.defaults({getContent:function(c,d,f,g){var h=c.viewModel.getMeta([f,g],"options"),i=d.split(" "),j=c.viewModel.getDataCID(f),k=a(b(h).reduce(function(a,c,d){var e=b(i).indexOf(c.value)>=0?" checked='true'":"";return a+"<input type='radio' name='"+j+"' id='radio_"+f+"_"+g+"_"+d+"'"+e+"><label for='radio_"+f+"_"+g+"_"+d+"'>"+c.label+"</label>"},""));return k.data("pos",{row:f,col:g}),k.on("change",function(){var d=a(this),f=d.parent().find("input[type=radio]"),g=d.data("pos"),h=c.viewModel.getMeta([g.row,g.col],"options"),i=f.map(function(b,c){return a(c).prop("checked")}),j=h[b.indexOf(i,!0)],k=j?j.value:e;c.viewModel.setData([g.row,g.col],k,{silent:!0})}),k}},p),q.link=b.defaults({getContent:function(c,d){var e=b.isObject(d)?d.href:d,f=b.isObject(d)?d.label:d;return a("<a href='"+e+"'>"+f+"</a>")}},p),q.toggleButton=b.defaults({click:function(a,b,c){var d=!!b.viewModel.getMeta([c,"*"],"closed");b.viewModel.setMeta([c,"*"],"closed",!d)},getContent:function(b,c,d){var e=!!b.viewModel.getMeta([d,"*"],"closed"),f=e?"+":"-";return a("<div class='toggleButton_button'>"+f+"</div><span class='toggleButton_text'>"+c+"<span>")}},p),b(g.fn).extend(o);var r=c.View.extend(n),s=c.Model.extend(b.extend({},j,l)),t=c.Collection.extend(b.extend({model:s},k,m));d.w5={Model:s,Collection:t,Grid:r}}(jQuery,_,Backbone,window);